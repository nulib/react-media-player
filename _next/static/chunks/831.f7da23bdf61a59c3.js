"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[831],{8448:function(e,t,i){i.d(t,{SV:function(){return o}});var r=i(959);let n=(0,r.createContext)(null),a={didCatch:!1,error:null};class o extends r.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=a}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){let{error:e}=this.state;if(null!==e){for(var t,i,r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];null===(t=(i=this.props).onReset)||void 0===t||t.call(i,{args:n,reason:"imperative-api"}),this.setState(a)}}componentDidCatch(e,t){var i,r;null===(i=(r=this.props).onError)||void 0===i||i.call(r,e,t)}componentDidUpdate(e,t){let{didCatch:i}=this.state,{resetKeys:r}=this.props;if(i&&null!==t.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==t.length||e.some((e,i)=>!Object.is(e,t[i]))}(e.resetKeys,r)){var n,o;null===(n=(o=this.props).onReset)||void 0===n||n.call(o,{next:r,prev:e.resetKeys,reason:"keys"}),this.setState(a)}}render(){let{children:e,fallbackRender:t,FallbackComponent:i,fallback:a}=this.props,{didCatch:o,error:l}=this.state,s=e;if(o){let e={error:l,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof t)s=t(e);else if(i)s=(0,r.createElement)(i,e);else if(null===a||(0,r.isValidElement)(a))s=a;else throw l}return(0,r.createElement)(n.Provider,{value:{didCatch:o,error:l,resetErrorBoundary:this.resetErrorBoundary}},s)}}},2950:function(e,t,i){let r;i.d(t,{Z:function(){return l}});var n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let a=new Uint8Array(16),o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));var l=function(e,t,i){if(n.randomUUID&&!t&&!e)return n.randomUUID();let l=(e=e||{}).random||(e.rng||function(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(a)})();if(l[6]=15&l[6]|64,l[8]=63&l[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=l[e];return t}return function(e,t=0){return o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]}(l)}},2024:function(e,t,i){i.d(t,{o0:function(){return el}});var r=i(5050).Buffer;function n(e){return e.endsWith("info.json")?e:e.endsWith("/")?`${e}info.json`:`${e}/info.json`}let a="http://library.stanford.edu/iiif/image-api/compliance.html#level1",o="http://library.stanford.edu/iiif/image-api/compliance.html#level2",l="http://library.stanford.edu/iiif/image-api/conformance.html#level1",s="http://library.stanford.edu/iiif/image-api/conformance.html#level2",h="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",f="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",u="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",d="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",p="http://iiif.io/api/image/1/level1.json",c="http://iiif.io/api/image/1/profiles/level1.json",g="http://iiif.io/api/image/1/level2.json",m="http://iiif.io/api/image/1/profiles/level2.json",v="http://iiif.io/api/image/2/level1.json",x="http://iiif.io/api/image/2/profiles/level1.json",y="http://iiif.io/api/image/2/level2.json",w="http://iiif.io/api/image/2/profiles/level2.json",b="level1",S="level2",j="http://iiif.io/api/image/2/level1",O="http://iiif.io/api/image/2/level2",F=[O,o,s,f,d,g,m,y,w,S],W=[...F,j,a,l,h,u,p,c,v,x,b],A=["http://iiif.io/api/image/2/level0",j,O,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",a,o,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",l,s,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",h,f,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",u,d,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",p,c,g,m,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",v,x,y,w,"level0",b,S],$={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["sizeByWhListed"]},I={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPx","regionSquare","sizeByWhListed","sizeByH","sizeByW","sizeByWh"]},k={extraFormats:["jpg","png"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPct","regionByPx","regionSquare","rotationBy90s","sizeByWhListed","sizeByConfinedWh","sizeByH","sizeByPct","sizeByW","sizeByWh"]};function z(e){return e["@id"]?e["@id"]:e.id?e.id:void 0}function B(e){if(!e||!e.profile||!z(e))return!1;for(let t of Array.isArray(e.profile)?e.profile:[e.profile])if("string"==typeof t&&-1!==A.indexOf(t))return!0;return!1}function E(e,t){if(t&&t.profile){let i=t.profile;if(i){let t=Array.isArray(i)?i:[i];return t.includes(`level${e}`)||t.includes(`http://iiif.io/api/image/2/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/profiles/level${e}.json`)}}return!1}function C(e){return B(e)?E(0,e)?0:E(1,e)?1:E(2,e)?2:null:null}function P(e){return -1!==(e["@context"]?Array.isArray(e["@context"])?e["@context"]:[e["@context"]]:[]).indexOf("http://iiif.io/api/image/3/context.json")}function R(e){let t=e.match(/^.*\/(full)\/(((\d+),(\d+)?)|max)\/(\d+)\/default\.(jpg|png|jpeg)$/);if(t){let i=t[1],r=parseInt(t[4],10),n=parseInt(t[5],10),a=t[7];if(("max"===i||"full"===i)&&r&&n&&a)return{type:"fixed",id:e,height:n,width:r}}return{type:"unknown",id:e}}function q(e){let t=[],i=e.length;for(let r=0;r<i;r++){let i=function(e){return B(e)?(e&&e.sizes?e.sizes:[]).map(t=>({id:z(e),type:"fixed-service",height:t.height,width:t.width,level:C(e),version:P(e)?3:2})):[]}(e[r]);i.length&&t.push(...i);let n=function(e){if(!function(e){if(!B(e))return!1;for(let t of Array.isArray(e.profile)?e.profile:[e.profile])if("string"==typeof t){if(-1!==W.indexOf(t))return!0}else{let e=[...t.supports||[],...t.extraFeatures||[]];if(-1!==e.indexOf("regionByPx")&&(-1!==e.indexOf("sizeByW")||-1!==e.indexOf("sizeByWh")))return!0}return!1}(e))return[];let t=[],i=Array.isArray(e.profile)?e.profile:[e.profile],r=i.length;for(let t=0;t<r;t++){let r=i[t];if("string"!=typeof r&&(r.maxHeight||r.maxWidth))return[{id:z(e),type:"variable",minWidth:0,minHeight:0,maxHeight:r.maxHeight||r.maxWidth,maxWidth:r.maxWidth||r.maxHeight,level:C(e),version:"http://iiif.io/api/image/3/context.json"===e["@context"]?3:2}]}if(e.tiles){let i=e.tiles.length;for(let r=0;r<i;r++){let i=e.tiles[r];(i.height||i.width)&&t.push({id:z(e),type:"variable",minHeight:0,minWidth:0,maxHeight:i.height||i.width,maxWidth:i.width,level:C(e),version:P(e)?3:2})}}return t}(e[r]);n.length&&t.push(...n)}return t}function H(e){let t=e.service?Array.isArray(e.service)?e.service:[e.service]:[],i=t.length,r=[];for(let e=0;e<i;e++)B(t[e])&&r.push(t[e]);return r}var U=Object.defineProperty,Q=Object.defineProperties,_=Object.getOwnPropertyDescriptors,D=Object.getOwnPropertySymbols,M=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable,T=(e,t,i)=>t in e?U(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,N=(e,t)=>{for(var i in t||(t={}))M.call(t,i)&&T(e,i,t[i]);if(D)for(var i of D(t))L.call(t,i)&&T(e,i,t[i]);return e},V=(e,t)=>Q(e,_(t));function J(e,t,i){let r=function(e){let t=function(e,t=""){let{path:i,scheme:r,server:n,prefix:a}=function(e,t=""){let i=e.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!i)throw Error(`Invalid or unknown input ${e}`);let r=i[2],n=i[3],a=i[4];if("/"===a[0]&&(a=a.substr(1)),t.length>0){if("/"===t[0]&&(t=t.substr(1)),t!==a.substr(0,t.length))throw Error(`Path does not start with prefix (path: ${a}, prefix: ${t})`);a=a.substr(t.length)}return{scheme:r,server:n,path:a,prefix:t}}(e,t),o=i.split("/").reverse(),[l,s,h,f,...u]=o,d=u.reverse().filter(Boolean).join("/");if(1===o.length||""===l)return{type:"base",scheme:r,server:n,prefix:a,identifier:d};if("info.json"===l){let[,...e]=o;return{type:"info",scheme:r,server:n,prefix:a,identifier:e.reverse().filter(Boolean).join("/")}}let p=l.split(".");return{type:"image",scheme:r,server:n,prefix:a,identifier:d,originalPath:i,region:function(e){try{if("full"===e)return{full:!0};if("square"===e)return{square:!0};let t=e.startsWith("pct:"),i=e.substr(t?4:0).split(",").map(e=>parseFloat(e));return{x:i[0],y:i[1],w:i[2],h:i[3],percent:t}}catch{throw Error("Expected 'full', 'square' or 'x,y,w,h'. Found "+e)}}(f),size:function(e){let t={upscaled:!1,max:!1,confined:!1};if("^"===e[0]&&(t.upscaled=!0,e=e.slice(1)),"max"===e||"full"===e)return t.max=!0,t.serialiseAsFull="full"===e,t;if("!"===e[0]&&(t.confined=!0,e=e.slice(1)),"p"===e[0])return t.percentScale=parseFloat(e.slice(4)),t;let i=e.split(",").map(e=>e.trim());return i.length&&(""!==i[0]&&(t.width=parseInt(i[0],10)),""!==i[1]?(t.height=parseInt(i[1],10),t.version=2):t.version=3),t}(h),rotation:function(e){let t={angle:0};if("!"===e[0]&&(t.mirror=!0,e=e.substr(1)),t.angle=parseFloat(e)%360,Number.isNaN(t.angle))throw Error(`Invalid rotation ${e}`);return t}(s),quality:p[0],format:p[1]}}(n(e.id));if("info"!==t.type)throw Error("Invalid service URL");let i=function(e){let t=e?Array.isArray(e.profile)?e.profile:[e.profile]:[],i={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let e of t){var r;if("string"==typeof e&&(r=e,e=-1!==F.indexOf(r)?k:-1!==W.indexOf(r)?I:$),e){if(e.formats)for(let t of e.formats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.qualities)for(let t of e.qualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);if(e.supports)for(let t of e.supports)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);if(e.maxHeight&&(i.maxHeight=e.maxHeight),e.maxWidth&&(i.maxWidth=e.maxWidth),e.maxArea&&(i.maxArea=e.maxArea),e.extraFormats)for(let t of e.extraFormats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.extraQualities)for(let t of e.extraQualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);if(e.extraFeatures)for(let t of e.extraFeatures)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);e.maxHeight&&(i.maxHeight=e.maxHeight),e.maxWidth&&(i.maxWidth=e.maxWidth),e.maxArea&&(i.maxArea=e.maxArea)}}if(e.extraFormats)for(let t of e.extraFormats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.extraFeatures)for(let t of e.extraFeatures)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);if(e.extraQualities)for(let t of e.extraQualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);return i}(e);return{identifier:t.identifier,originalPath:"",server:t.server,prefix:t.prefix,scheme:t.scheme,type:"image",quality:-1===i.extraQualities.indexOf("default")?i.extraQualities[0]:"default",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:"jpg",rotation:{angle:0}}}({"@context":3===e.version?"http://iiif.io/api/image/3/context.json":"http://iiif.io/api/image/2/context.json",id:n(z(e)),profile:null===e.level||typeof e.level>"u"?"level0":`level${e.level}}`,type:3===e.version?"ImageService3":"ImageService2"});if("image"!==r.type)throw Error("Invalid service");return r.size.max=!1,r.size.width=t,r.size.height=i,{id:function(e,t){let i=e.prefix.startsWith("/")?e.prefix.substr(1):e.prefix,r=`${e.scheme}://${e.server}/${i?`${i}/`:""}${e.identifier}`;if("base"===e.type)return r;if("info"===e.type)return`${r}/info.json`;let{size:n}=e,{region:a,rotation:o,format:l,quality:s}=e;if(t){let e=t["@context"]?Array.isArray(t["@context"])?t["@context"]:[t["@context"]]:[],i=-1!==e.indexOf("http://iiif.io/api/image/2/context.json"),r=-1!==e.indexOf("http://iiif.io/api/image/3/context.json");if((n.width!==t.width||n.height)&&(n.height!==t.height||n.width)&&(n.width!==t.width||n.height!==t.height)||(n=V(N({},n),{max:!0})),i&&(n.max&&!n.serialiseAsFull&&(n=V(N({},n),{serialiseAsFull:!0})),!n.max&&n.width&&n.height&&(n=V(N({},n),{height:void 0})),n=V(N({},n),{version:2})),r){if(n.max&&n.serialiseAsFull&&(n=V(N({},n),{serialiseAsFull:!1})),n.width&&!n.height&&t.width&&t.height){let e=t.height/t.width;n=V(N({},n),{height:Math.ceil(n.width*e)})}n=V(N({},n),{version:3})}}return[r,function({x:e=0,y:t=0,w:i,h:r,full:n,square:a,percent:o}){if(n)return"full";if(a)return"square";if(typeof i>"u"||typeof r>"u")throw Error("RegionParameter: invalid region");let l=`${e},${t},${i},${r}`;return o?`pct:${l}`:l}(a),function({max:e,percentScale:t,upscaled:i,confined:r,width:n,height:a,serialiseAsFull:o,version:l}){let s=[];return i&&s.push("^"),e?s.push(o?"full":"max"):(r&&s.push("!"),t&&s.push(`pct:${t}`),n&&s.push(`${n}`),s.push(","),a&&3===l&&s.push(`${a}`)),s.join("")}(n),`${o.mirror?"!":""}${(o.angle||0)%360}`,`${s}.${l}`].filter(Boolean).join("/")}(r),type:"fixed",width:t,height:i||e.height/(e.width||1)*t,unsafe:e.width>t}}function K(e){let t=e.replace(/(https?:\/\/)?(www.)?/i,"");return -1!==t.indexOf("/")?t.split("/")[0]:t}var Z=Object.defineProperty,G=Object.defineProperties,X=Object.getOwnPropertyDescriptors,Y=Object.getOwnPropertySymbols,ee=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable,ei=(e,t,i)=>t in e?Z(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,er=(e,t)=>{for(var i in t||(t={}))ee.call(t,i)&&ei(e,i,t[i]);if(Y)for(var i of Y(t))et.call(t,i)&&ei(e,i,t[i]);return e},en=(e,t)=>G(e,X(t)),ea=(e,t,i)=>new Promise((r,n)=>{var a=e=>{try{l(i.next(e))}catch(e){n(e)}},o=e=>{try{l(i.throw(e))}catch(e){n(e)}},l=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);l((i=i.apply(e,t)).next())});class eo{constructor(){this.config={verificationsRequired:1,approximateServices:!0,enableFetching:!0,disableThrottling:!1},this.fetchingCount=0,this.imageServices={},this.knownImageServers={}}setConfig(e){Object.assign(this.config,e)}sample(e,t,i=!0){let r=K(z(e)),a=n(z(e)),o=this.knownImageServers[r];return this.imageServices[a]=Object.assign(e,{real:!0}),o||!e.tiles||E(0,e)?this.verify(e):(this.knownImageServers[r]={verifications:0,malformed:!1,root:r,preLoaded:i,sampledId:z(e),verified:!1,server:null,result:{context:e["@context"]||[],sampledProfile:e.profile,resourceServiceRatio:t&&e.height?t.height/e.height:1,sampledSizes:e.sizes||[],sizeRatios:function(e,t,i){let r=i.length,n=[];for(let t=0;t<r;t++){let r=i[t].width;n.push(e/r)}return n}(e.width,e.height,e.sizes||[]),sampledTiles:e.tiles||[]}},!0)}preLoad(e,t=!0){this.knownImageServers[e.root]=e,t&&(this.knownImageServers[e.root].malformed=!1,this.knownImageServers[e.root].verifications=this.config.verificationsRequired)}predict(e,t=!1,i=!1){let r=null==e?void 0:e.source,a=K(z(e)),o=this.knownImageServers[a];if(!o||!o.result||!((null==r?void 0:r.height)||e.height)||!((null==r?void 0:r.width)||e.width)||!i&&(o.malformed||o.verifications<this.config.verificationsRequired)||E(0,e.source))return null;let l=n(z(e));return this.imageServices[l]||(this.imageServices[l]={"@context":o.result.context,"@id":z(e),id:z(e),protocol:"http://iiif.io/api/image",tiles:(null==r?void 0:r.tiles)||function(e,t,i){let r=e>t?e:t,n=i.length,a=[];for(let e=0;e<n;e++){let t=i[e],n=t.scaleFactors[0],o=r/n,l=[n];for(;o>=t.width;)n*=2,l.push(n),o/=2;a.push(en(er({},t),{scaleFactors:l}))}return a}(e.width,e.height,o.result.sampledTiles),sizes:(null==r?void 0:r.sizes)||function(e,t,i){let r=i.length,n=[];for(let a=0;a<r;a++){let r=i[a];n.push({width:Math.floor(e/r),height:Math.floor(t/r)})}return n}(Math.round(e.width/o.result.resourceServiceRatio),Math.round(e.height/o.result.resourceServiceRatio),o.result.sizeRatios),profile:(null==r?void 0:r.profile)||o.result.sampledProfile,height:(null==r?void 0:r.height)||e.height,width:(null==r?void 0:r.width)||e.width,real:!1}),this.imageServices[l]}getThumbnailFromResource(e,t){return ea(this,arguments,function*(e,t,i=!0,r=[]){let n=e?yield this.getImageCandidates(e,i):[];return function(e,t){let i=[],r=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},e),n=(e,t=0)=>r.explain?i.push(Array(t).fill(0).map(e=>"    ").join("")+e().trim()):void 0,a=[],o=[],l=null;n(()=>`Using configuration: ${JSON.stringify(r,null,2)}`);let s=(e,t)=>{if(n(()=>"Swapping choice",3),function(e,t,i){let r=e.width?e.width:e.maxWidth;return i.height<=e.maxHeight&&i.width<=e.maxWidth&&i.height>=e.minHeight&&i.width>=e.minWidth&&(!t||Math.abs(i.width-r)<Math.abs(t.width-r))}(r,t,e)){if(r.preferFixedSize&&e.unsafe){n(()=>`We found an image that was marked as unsafe, but it was the best size. (${e.id})`,4),o.push(e);return}r.returnAllOptions&&t&&o.push(t),n(()=>`We found a new image that was the best size. (${e.id})`,4),l=e}else r.returnAllOptions&&o.push(e)};n(()=>`The input shows we have ${t.length} list(s) of candidates to choose from.`);let h=t.length;for(let e=0;e<h;e++){let i=t[e]();n(()=>`Candidate group ${e}: ${JSON.stringify(i,null,2)}`,1);let o=i.length;n(()=>`Checking candidate list number ${e} and found ${o} potential ways of creating image(s)`,1);for(let e=0;e<o;e++){let t=i[e];n(()=>`-> Checking candidate ${e}`,1),"unknown"===t.type&&r.atAnyCost&&(n(()=>'We\'ve found an unknown image type, adding this to the "last resort" list',2),a.push(t)),"fixed"===t.type&&(t.unsafe?(n(()=>'We\'ve found an unsafe fixed image type, adding this to the "last resort" list',2),a.push(t)):(n(()=>"We've found a fixed size image, checking if it matches the request",2),s(t,l))),"fixed-service"===t.type&&(r.unsafeImageService?(n(()=>"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)",2),s(J(t,r.width,r.height),l)):(n(()=>"Checking for an image from the tile source 3",2),s(J(t,t.width,t.height),l))),"variable"===t.type&&t.maxWidth&&s(J({id:t.id,type:"fixed-service",width:t.maxWidth,height:t.maxWidth,level:t.level,version:t.version},t.maxWidth),l)}if(l&&!r.returnAllOptions){if(l.unsafe||r.allowUnsafe)continue;n(()=>`We found a match in choice list number ${e}, no searching any more`);break}}return r.atAnyCost&&0===o.length?(n(()=>l?`We found an image! ${l.id} of type ${l.type}`:'We found no images, but "atAnyCost" is set, so returning that'),{best:l||a[0],fallback:a.slice(1),log:i}):r.returnAllOptions?(n(()=>"Returning all options that we have found"),{best:r.atAnyCost?l||o[0]||a[0]:l||o[0],fallback:[...o,...a],log:i}):(n(()=>"Returning the best image that we found, and a fallback"),{best:l||o[0]||null,fallback:l?o:o.slice(1),log:i})}(t,[()=>r,()=>n])})}getImageCandidates(e,t=!0){return ea(this,null,function*(){if(t&&e.height&&e.width)for(let t of H(e)){let i={id:z(t),width:t.width?t.width:e.width,height:t.height?t.height:e.height,source:t};yield this.loadService(i)}return function(e,t=!0,i){let r=[],n=function(e){if("string"==typeof e)return R(e);let t=e["@type"]?e["@type"]:e.type?e.type:void 0;if("Image"!==t&&"sc:Image"!==t)return null;let i=z(e);return i?i&&e.width&&e.height?{id:i,type:"fixed",width:e.width,height:e.height,unsafe:!0}:R(i):null}(e);if(null===n)return r;if(r.push(n),t&&e.width&&e.height){let t=[];for(let r of H(e)){let n={id:z(r),width:e.width,height:e.height};if(i.canLoadSync(n)){let r=i.loadServiceSync(n);r&&(r.height||(r.height=e.height),r.width||(r.width=e.width),t.push(...q([r])))}}if(t.length)return r.push(...t),r}return e.service&&r.push(...q(e.service)),r}(e,t,this)})}verify(e){return ea(this,null,function*(){let t=this.predict(e,!1,!0),i=yield this.fetchService(z(e));if(!t)return!1;let r=t.height===i.height&&t.width===i.width&&t["@context"]===i["@context"]&&function(e,t){if(e.length!==t.length)return!1;if(0===e.length&&0===t.length)return!0;let i=e.length,r=!0;for(let n=0;n<i;n++){let i=e[n],a=t[n];if(i.width!==a.width||i.height!==a.height){r=!1;break}}if(r)return!0;let n=0;for(let r=0;r<i;r++)for(let a=0;a<i;a++)if(e[r].width===t[a].width&&e[r].height===t[a].height){n++;break}return n===i}(t.sizes||[],i.sizes||[]);if(r){let t=K(z(e));this.knownImageServers[t].verifications+=1,this.knownImageServers[t].verifications>=this.config.verificationsRequired&&(this.knownImageServers[t].verified=!0)}return r})}canLoadSync(e){let t="string"==typeof e?e:z(e),i=n(t);if(this.imageServices[i])return!0;let r=this.knownImageServers[K(t)];return r&&!r.malformed&&r.verifications>=this.config.verificationsRequired}markAsMalformed(e){return ea(this,null,function*(){return this.knownImageServers[K(z(e))].malformed=!0,this.loadService(e,!0)})}fetchService(e,t=!1){return ea(this,null,function*(){let i=n(e);if(this.imageServices[i]&&(!t||this.imageServices[i].real))return this.imageServices[i];if(!this.config.enableFetching)throw Error("Fetching is not enabled");let r=yield this.fetch(i).then(e=>e.json());return!r.id&&r["@id"]&&(r.id=r["@id"]),r.id!==e&&(r.id=e,r["@id"]&&(r["@id"]=e)),this.imageServices[i]=Object.assign(r,{real:!0}),this.imageServices[i]})}fetch(e,t){return ea(this,null,function*(){return fetch(e,t)})}loadService(e,t=!1){return ea(this,null,function*(){if(!this.config.disableThrottling){let e=!0;for(;e;)if(this.fetchingCount>=this.config.verificationsRequired)yield new Promise(e=>setTimeout(e,500));else{e=!1;break}}let i=this.knownImageServers[K(z(e))];if(i&&!i.malformed&&!t){yield i.result;let t=this.loadServiceSync(e);if(t)return t}this.fetchingCount++;let r=yield this.fetchService(z(e),t);return this.fetchingCount--,r.real&&this.sample(r,e),r})}loadServiceSync(e){let t=n(z(e));return this.imageServices[t]?this.imageServices[t]:this.predict(e)}}function el(e){let t=(function(e){let t=e.length%4;if(1===t)throw Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");return e+(t?"====".slice(0,4-t):"")})(e).replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent("undefined"==typeof atob?r.from(t,"base64").toString("utf-8"):atob(t)).trim()}new eo,Symbol.for("_refs_"),Symbol.for("_reactive_"),Symbol.for("_defined_")}}]);