(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[50],{8448:function(e,t,i){"use strict";i.d(t,{SV:function(){return o}});var r=i(959);let n=(0,r.createContext)(null),a={didCatch:!1,error:null};class o extends r.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=a}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(){let{error:e}=this.state;if(null!==e){for(var t,i,r=arguments.length,n=Array(r),o=0;o<r;o++)n[o]=arguments[o];null===(t=(i=this.props).onReset)||void 0===t||t.call(i,{args:n,reason:"imperative-api"}),this.setState(a)}}componentDidCatch(e,t){var i,r;null===(i=(r=this.props).onError)||void 0===i||i.call(r,e,t)}componentDidUpdate(e,t){let{didCatch:i}=this.state,{resetKeys:r}=this.props;if(i&&null!==t.error&&function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.length!==t.length||e.some((e,i)=>!Object.is(e,t[i]))}(e.resetKeys,r)){var n,o;null===(n=(o=this.props).onReset)||void 0===n||n.call(o,{next:r,prev:e.resetKeys,reason:"keys"}),this.setState(a)}}render(){let{children:e,fallbackRender:t,FallbackComponent:i,fallback:a}=this.props,{didCatch:o,error:s}=this.state,l=e;if(o){let e={error:s,resetErrorBoundary:this.resetErrorBoundary};if("function"==typeof t)l=t(e);else if(i)l=(0,r.createElement)(i,e);else if(null===a||(0,r.isValidElement)(a))l=a;else throw s}return(0,r.createElement)(n.Provider,{value:{didCatch:o,error:s,resetErrorBoundary:this.resetErrorBoundary}},l)}}},1518:function(e,t){!function(e){"use strict";function t(e){return null==e}function i(e){throw Error("Argument "+e+" is empty.")}function r(e){return"function"==typeof e&&"getType"in e}function n(e){throw Error("Argument "+e+' is invalid, it should be an action-creator instance from "typesafe-actions"')}function a(e,t){if(null==e)throw Error("Argument contains array with empty element at index "+t);if(null==e.getType)throw Error("Argument contains array with invalid element at index "+t+', it should be an action-creator instance from "typesafe-actions"')}function o(e){return"string"==typeof e||"symbol"==typeof e}function s(e){throw Error("Argument "+e+" is invalid, it should be an action type of type: string | symbol")}function l(e,t){if(null==e)throw Error("Argument contains array with empty element at index "+t);if("string"!=typeof e&&"symbol"!=typeof e)throw Error("Argument contains array with invalid element at index "+t+", it should be of type: string | symbol")}function u(e,r,a,s){return t(e)&&i(1),o(e)||n(1),{type:e,payload:r,meta:a,error:s}}function c(e,r){return t(e)&&i(1),o(e)||s(1),Object.assign(function(){var t=null!=r?r.apply(void 0,arguments):void 0;return Object.assign({type:e},t)},{getType:function(){return e},toString:function(){return e}})}function h(e,r,n){return t(e)&&i(1),o(e)||s(1),function(){return c(e,function(){var e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1];return null==r&&null==n||(e=null!=r?r.apply(void 0,arguments):void 0,t=null!=n?n.apply(void 0,arguments):void 0),Object.assign({},void 0!==e&&{payload:e},{},void 0!==t&&{meta:t})})}}function f(e){return t(e)&&i(1),r(e)||n(1),e.getType()}function p(e,r){return t(e)&&i(1),o(e)||s(1),Object.assign(null!=r?r(e):function(){return{type:e}},{getType:function(){return e},toString:function(){return e}})}e.action=u,e.createAction=h,e.createAsyncAction=function(e,t,i,r){return function(){var n=[e,t,i,r].map(function(e,t){return Array.isArray(e)?h(e[0],e[1],e[2])():"string"==typeof e||"symbol"==typeof e?h(e)():void(t<3&&function(e){throw Error("Argument "+e+' is invalid, it should be an action type of "string | symbol" or a tuple of "[string | symbol, Function, Function?]"')}(t))});return{request:n[0],success:n[1],failure:n[2],cancel:n[3]}}},e.createCustomAction=c,e.createReducer=function e(t,i){void 0===i&&(i={});var n=Object.assign({},i),a=function(i,a){var s=Array.isArray(i)?i:[i],l={};return s.map(function(e,t){return r(e)?f(e):o(e)?e:function(e){throw Error("Argument "+e+' is invalid, it should be an action-creator instance from "typesafe-actions" or action type of type: string | symbol')}(t+1)}).forEach(function(e){return l[e]=a}),e(t,Object.assign({},n,{},l))};return Object.assign(function(e,i){if(void 0===e&&(e=t),n.hasOwnProperty(i.type)){var r=n[i.type];if("function"!=typeof r)throw Error('Reducer under "'+i.type+'" key is not a valid reducer');return r(e,i)}return e},{handlers:Object.assign({},n),handleAction:a,handleType:a})},e.deprecated={createAction:function(e,t){return Object.assign(null==t?function(){return u(e)}:t(u.bind(null,e)),{getType:function(){return e},toString:function(){return e}})},createCustomAction:p,createStandardAction:function(e){return t(e)&&i(1),o(e)||s(1),Object.assign(function(){return p(e,function(e){return function(t,i){return{type:e,payload:t,meta:i}}})},{map:function(t){return p(e,function(e){return function(i,r){return Object.assign(t(i,r),{type:e})}})}})}},e.getType=f,e.isActionOf=function(e,r){t(e)&&i(1);var n=Array.isArray(e)?e:[e];n.forEach(a);var o=function(e){return n.some(function(t){return e.type===t.getType()})};return void 0===r?o:o(r)},e.isOfType=function(e,r){t(e)&&i(1);var n=Array.isArray(e)?e:[e];n.forEach(l);var a=function(e){return n.includes(e.type)};return void 0===r?a:a(r)}}(t)},2950:function(e,t,i){"use strict";let r;i.d(t,{Z:function(){return s}});var n={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let a=new Uint8Array(16),o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));var s=function(e,t,i){if(n.randomUUID&&!t&&!e)return n.randomUUID();let s=(e=e||{}).random||(e.rng||function(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(a)})();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t){i=i||0;for(let e=0;e<16;++e)t[i+e]=s[e];return t}return function(e,t=0){return o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]}(s)}},1921:function(e,t,i){"use strict";i.d(t,{o0:function(){return es}});var r=i(1196).Buffer;function n(e){return e.endsWith("info.json")?e:e.endsWith("/")?`${e}info.json`:`${e}/info.json`}let a="http://library.stanford.edu/iiif/image-api/compliance.html#level1",o="http://library.stanford.edu/iiif/image-api/compliance.html#level2",s="http://library.stanford.edu/iiif/image-api/conformance.html#level1",l="http://library.stanford.edu/iiif/image-api/conformance.html#level2",u="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",c="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",h="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",f="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",p="http://iiif.io/api/image/1/level1.json",d="http://iiif.io/api/image/1/profiles/level1.json",v="http://iiif.io/api/image/1/level2.json",y="http://iiif.io/api/image/1/profiles/level2.json",g="http://iiif.io/api/image/2/level1.json",m="http://iiif.io/api/image/2/profiles/level1.json",b="http://iiif.io/api/image/2/level2.json",A="http://iiif.io/api/image/2/profiles/level2.json",w="level1",x="level2",C="http://iiif.io/api/image/2/level1",S="http://iiif.io/api/image/2/level2",O=[S,o,l,c,f,v,y,b,A,x],R=[...O,C,a,s,u,h,p,d,g,m,w],j=["http://iiif.io/api/image/2/level0",C,S,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",a,o,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",s,l,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",u,c,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",h,f,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",p,d,v,y,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",g,m,b,A,"level0",w,x],E={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["sizeByWhListed"]},I={extraFormats:["jpg"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPx","regionSquare","sizeByWhListed","sizeByH","sizeByW","sizeByWh"]},T={extraFormats:["jpg","png"],extraQualities:["default"],extraFeatures:["baseUriRedirect","cors","jsonldMediaType","regionByPct","regionByPx","regionSquare","rotationBy90s","sizeByWhListed","sizeByConfinedWh","sizeByH","sizeByPct","sizeByW","sizeByWh"]};function k(e){return e["@id"]?e["@id"]:e.id?e.id:void 0}function P(e){if(!e||!e.profile||!k(e))return!1;for(let t of Array.isArray(e.profile)?e.profile:[e.profile])if("string"==typeof t&&-1!==j.indexOf(t))return!0;return!1}function M(e,t){if(t&&t.profile){let i=t.profile;if(i){let t=Array.isArray(i)?i:[i];return t.includes(`level${e}`)||t.includes(`http://iiif.io/api/image/2/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/level${e}.json`)||t.includes(`http://iiif.io/api/image/1/profiles/level${e}.json`)}}return!1}function L(e){return P(e)?M(0,e)?0:M(1,e)?1:M(2,e)?2:null:null}function D(e){return -1!==(e["@context"]?Array.isArray(e["@context"])?e["@context"]:[e["@context"]]:[]).indexOf("http://iiif.io/api/image/3/context.json")}function F(e){let t=e.match(/^.*\/(full)\/(((\d+),(\d+)?)|max)\/(\d+)\/default\.(jpg|png|jpeg)$/);if(t){let i=t[1],r=parseInt(t[4],10),n=parseInt(t[5],10),a=t[7];if(("max"===i||"full"===i)&&r&&n&&a)return{type:"fixed",id:e,height:n,width:r}}return{type:"unknown",id:e}}function U(e){let t=[],i=e.length;for(let r=0;r<i;r++){let i=function(e){return P(e)?(e&&e.sizes?e.sizes:[]).map(t=>({id:k(e),type:"fixed-service",height:t.height,width:t.width,level:L(e),version:D(e)?3:2})):[]}(e[r]);i.length&&t.push(...i);let n=function(e){if(!function(e){if(!P(e))return!1;for(let t of Array.isArray(e.profile)?e.profile:[e.profile])if("string"==typeof t){if(-1!==R.indexOf(t))return!0}else{let e=[...t.supports||[],...t.extraFeatures||[]];if(-1!==e.indexOf("regionByPx")&&(-1!==e.indexOf("sizeByW")||-1!==e.indexOf("sizeByWh")))return!0}return!1}(e))return[];let t=[],i=Array.isArray(e.profile)?e.profile:[e.profile],r=i.length;for(let t=0;t<r;t++){let r=i[t];if("string"!=typeof r&&(r.maxHeight||r.maxWidth))return[{id:k(e),type:"variable",minWidth:0,minHeight:0,maxHeight:r.maxHeight||r.maxWidth,maxWidth:r.maxWidth||r.maxHeight,level:L(e),version:"http://iiif.io/api/image/3/context.json"===e["@context"]?3:2}]}if(e.tiles){let i=e.tiles.length;for(let r=0;r<i;r++){let i=e.tiles[r];(i.height||i.width)&&t.push({id:k(e),type:"variable",minHeight:0,minWidth:0,maxHeight:i.height||i.width,maxWidth:i.width,level:L(e),version:D(e)?3:2})}}return t}(e[r]);n.length&&t.push(...n)}return t}function $(e){let t=e.service?Array.isArray(e.service)?e.service:[e.service]:[],i=t.length,r=[];for(let e=0;e<i;e++)P(t[e])&&r.push(t[e]);return r}var q=Object.defineProperty,W=Object.defineProperties,_=Object.getOwnPropertyDescriptors,B=Object.getOwnPropertySymbols,N=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable,Q=(e,t,i)=>t in e?q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,H=(e,t)=>{for(var i in t||(t={}))N.call(t,i)&&Q(e,i,t[i]);if(B)for(var i of B(t))z.call(t,i)&&Q(e,i,t[i]);return e},V=(e,t)=>W(e,_(t));function K(e,t,i){let r=function(e){let t=function(e,t=""){let{path:i,scheme:r,server:n,prefix:a}=function(e,t=""){let i=e.match(/^(([a-zA-Z]+):\/\/([^/]+))?((.*)+)/);if(!i)throw Error(`Invalid or unknown input ${e}`);let r=i[2],n=i[3],a=i[4];if("/"===a[0]&&(a=a.substr(1)),t.length>0){if("/"===t[0]&&(t=t.substr(1)),t!==a.substr(0,t.length))throw Error(`Path does not start with prefix (path: ${a}, prefix: ${t})`);a=a.substr(t.length)}return{scheme:r,server:n,path:a,prefix:t}}(e,t),o=i.split("/").reverse(),[s,l,u,c,...h]=o,f=h.reverse().filter(Boolean).join("/");if(1===o.length||""===s)return{type:"base",scheme:r,server:n,prefix:a,identifier:f};if("info.json"===s){let[,...e]=o;return{type:"info",scheme:r,server:n,prefix:a,identifier:e.reverse().filter(Boolean).join("/")}}let p=s.split(".");return{type:"image",scheme:r,server:n,prefix:a,identifier:f,originalPath:i,region:function(e){try{if("full"===e)return{full:!0};if("square"===e)return{square:!0};let t=e.startsWith("pct:"),i=e.substr(t?4:0).split(",").map(e=>parseFloat(e));return{x:i[0],y:i[1],w:i[2],h:i[3],percent:t}}catch{throw Error("Expected 'full', 'square' or 'x,y,w,h'. Found "+e)}}(c),size:function(e){let t={upscaled:!1,max:!1,confined:!1};if("^"===e[0]&&(t.upscaled=!0,e=e.slice(1)),"max"===e||"full"===e)return t.max=!0,t.serialiseAsFull="full"===e,t;if("!"===e[0]&&(t.confined=!0,e=e.slice(1)),"p"===e[0])return t.percentScale=parseFloat(e.slice(4)),t;let i=e.split(",").map(e=>e.trim());return i.length&&(""!==i[0]&&(t.width=parseInt(i[0],10)),""!==i[1]?(t.height=parseInt(i[1],10),t.version=2):t.version=3),t}(u),rotation:function(e){let t={angle:0};if("!"===e[0]&&(t.mirror=!0,e=e.substr(1)),t.angle=parseFloat(e)%360,Number.isNaN(t.angle))throw Error(`Invalid rotation ${e}`);return t}(l),quality:p[0],format:p[1]}}(n(e.id));if("info"!==t.type)throw Error("Invalid service URL");let i=function(e){let t=e?Array.isArray(e.profile)?e.profile:[e.profile]:[],i={extraQualities:[],extraFormats:[],extraFeatures:[]};for(let e of t){var r;if("string"==typeof e&&(r=e,e=-1!==O.indexOf(r)?T:-1!==R.indexOf(r)?I:E),e){if(e.formats)for(let t of e.formats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.qualities)for(let t of e.qualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);if(e.supports)for(let t of e.supports)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);if(e.maxHeight&&(i.maxHeight=e.maxHeight),e.maxWidth&&(i.maxWidth=e.maxWidth),e.maxArea&&(i.maxArea=e.maxArea),e.extraFormats)for(let t of e.extraFormats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.extraQualities)for(let t of e.extraQualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);if(e.extraFeatures)for(let t of e.extraFeatures)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);e.maxHeight&&(i.maxHeight=e.maxHeight),e.maxWidth&&(i.maxWidth=e.maxWidth),e.maxArea&&(i.maxArea=e.maxArea)}}if(e.extraFormats)for(let t of e.extraFormats)-1===i.extraFormats.indexOf(t)&&i.extraFormats.push(t);if(e.extraFeatures)for(let t of e.extraFeatures)-1===i.extraFeatures.indexOf(t)&&i.extraFeatures.push(t);if(e.extraQualities)for(let t of e.extraQualities)-1===i.extraQualities.indexOf(t)&&i.extraQualities.push(t);return i}(e);return{identifier:t.identifier,originalPath:"",server:t.server,prefix:t.prefix,scheme:t.scheme,type:"image",quality:-1===i.extraQualities.indexOf("default")?i.extraQualities[0]:"default",region:{full:!0},size:{max:!0,upscaled:!1,confined:!1},format:"jpg",rotation:{angle:0}}}({"@context":3===e.version?"http://iiif.io/api/image/3/context.json":"http://iiif.io/api/image/2/context.json",id:n(k(e)),profile:null===e.level||typeof e.level>"u"?"level0":`level${e.level}}`,type:3===e.version?"ImageService3":"ImageService2"});if("image"!==r.type)throw Error("Invalid service");return r.size.max=!1,r.size.width=t,r.size.height=i,{id:function(e,t){let i=e.prefix.startsWith("/")?e.prefix.substr(1):e.prefix,r=`${e.scheme}://${e.server}/${i?`${i}/`:""}${e.identifier}`;if("base"===e.type)return r;if("info"===e.type)return`${r}/info.json`;let{size:n}=e,{region:a,rotation:o,format:s,quality:l}=e;if(t){let e=t["@context"]?Array.isArray(t["@context"])?t["@context"]:[t["@context"]]:[],i=-1!==e.indexOf("http://iiif.io/api/image/2/context.json"),r=-1!==e.indexOf("http://iiif.io/api/image/3/context.json");if((n.width!==t.width||n.height)&&(n.height!==t.height||n.width)&&(n.width!==t.width||n.height!==t.height)||(n=V(H({},n),{max:!0})),i&&(n.max&&!n.serialiseAsFull&&(n=V(H({},n),{serialiseAsFull:!0})),!n.max&&n.width&&n.height&&(n=V(H({},n),{height:void 0})),n=V(H({},n),{version:2})),r){if(n.max&&n.serialiseAsFull&&(n=V(H({},n),{serialiseAsFull:!1})),n.width&&!n.height&&t.width&&t.height){let e=t.height/t.width;n=V(H({},n),{height:Math.ceil(n.width*e)})}n=V(H({},n),{version:3})}}return[r,function({x:e=0,y:t=0,w:i,h:r,full:n,square:a,percent:o}){if(n)return"full";if(a)return"square";if(typeof i>"u"||typeof r>"u")throw Error("RegionParameter: invalid region");let s=`${e},${t},${i},${r}`;return o?`pct:${s}`:s}(a),function({max:e,percentScale:t,upscaled:i,confined:r,width:n,height:a,serialiseAsFull:o,version:s}){let l=[];return i&&l.push("^"),e?l.push(o?"full":"max"):(r&&l.push("!"),t&&l.push(`pct:${t}`),n&&l.push(`${n}`),l.push(","),a&&3===s&&l.push(`${a}`)),l.join("")}(n),`${o.mirror?"!":""}${(o.angle||0)%360}`,`${l}.${s}`].filter(Boolean).join("/")}(r),type:"fixed",width:t,height:i||e.height/(e.width||1)*t,unsafe:e.width>t}}function Y(e){let t=e.replace(/(https?:\/\/)?(www.)?/i,"");return -1!==t.indexOf("/")?t.split("/")[0]:t}var G=Object.defineProperty,J=Object.defineProperties,X=Object.getOwnPropertyDescriptors,Z=Object.getOwnPropertySymbols,ee=Object.prototype.hasOwnProperty,et=Object.prototype.propertyIsEnumerable,ei=(e,t,i)=>t in e?G(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,er=(e,t)=>{for(var i in t||(t={}))ee.call(t,i)&&ei(e,i,t[i]);if(Z)for(var i of Z(t))et.call(t,i)&&ei(e,i,t[i]);return e},en=(e,t)=>J(e,X(t)),ea=(e,t,i)=>new Promise((r,n)=>{var a=e=>{try{s(i.next(e))}catch(e){n(e)}},o=e=>{try{s(i.throw(e))}catch(e){n(e)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(a,o);s((i=i.apply(e,t)).next())});class eo{constructor(){this.config={verificationsRequired:1,approximateServices:!0,enableFetching:!0,disableThrottling:!1},this.fetchingCount=0,this.imageServices={},this.knownImageServers={}}setConfig(e){Object.assign(this.config,e)}sample(e,t,i=!0){let r=Y(k(e)),a=n(k(e)),o=this.knownImageServers[r];return this.imageServices[a]=Object.assign(e,{real:!0}),o||!e.tiles||M(0,e)?this.verify(e):(this.knownImageServers[r]={verifications:0,malformed:!1,root:r,preLoaded:i,sampledId:k(e),verified:!1,server:null,result:{context:e["@context"]||[],sampledProfile:e.profile,resourceServiceRatio:t&&e.height?t.height/e.height:1,sampledSizes:e.sizes||[],sizeRatios:function(e,t,i){let r=i.length,n=[];for(let t=0;t<r;t++){let r=i[t].width;n.push(e/r)}return n}(e.width,e.height,e.sizes||[]),sampledTiles:e.tiles||[]}},!0)}preLoad(e,t=!0){this.knownImageServers[e.root]=e,t&&(this.knownImageServers[e.root].malformed=!1,this.knownImageServers[e.root].verifications=this.config.verificationsRequired)}predict(e,t=!1,i=!1){let r=null==e?void 0:e.source,a=Y(k(e)),o=this.knownImageServers[a];if(!o||!o.result||!((null==r?void 0:r.height)||e.height)||!((null==r?void 0:r.width)||e.width)||!i&&(o.malformed||o.verifications<this.config.verificationsRequired)||M(0,e.source))return null;let s=n(k(e));return this.imageServices[s]||(this.imageServices[s]={"@context":o.result.context,"@id":k(e),id:k(e),protocol:"http://iiif.io/api/image",tiles:(null==r?void 0:r.tiles)||function(e,t,i){let r=e>t?e:t,n=i.length,a=[];for(let e=0;e<n;e++){let t=i[e],n=t.scaleFactors[0],o=r/n,s=[n];for(;o>=t.width;)n*=2,s.push(n),o/=2;a.push(en(er({},t),{scaleFactors:s}))}return a}(e.width,e.height,o.result.sampledTiles),sizes:(null==r?void 0:r.sizes)||function(e,t,i){let r=i.length,n=[];for(let a=0;a<r;a++){let r=i[a];n.push({width:Math.floor(e/r),height:Math.floor(t/r)})}return n}(Math.round(e.width/o.result.resourceServiceRatio),Math.round(e.height/o.result.resourceServiceRatio),o.result.sizeRatios),profile:(null==r?void 0:r.profile)||o.result.sampledProfile,height:(null==r?void 0:r.height)||e.height,width:(null==r?void 0:r.width)||e.width,real:!1}),this.imageServices[s]}getThumbnailFromResource(e,t){return ea(this,arguments,function*(e,t,i=!0,r=[]){let n=e?yield this.getImageCandidates(e,i):[];return function(e,t){let i=[],r=Object.assign({unsafeImageService:!1,atAnyCost:!0,fallback:!0,minHeight:64,minWidth:64,maxHeight:1/0,maxWidth:1/0,returnAllOptions:!1,preferFixedSize:!1,allowUnsafe:!1,explain:!1,height:0,width:0},e),n=(e,t=0)=>r.explain?i.push(Array(t).fill(0).map(e=>"    ").join("")+e().trim()):void 0,a=[],o=[],s=null;n(()=>`Using configuration: ${JSON.stringify(r,null,2)}`);let l=(e,t)=>{if(n(()=>"Swapping choice",3),function(e,t,i){let r=e.width?e.width:e.maxWidth;return i.height<=e.maxHeight&&i.width<=e.maxWidth&&i.height>=e.minHeight&&i.width>=e.minWidth&&(!t||Math.abs(i.width-r)<Math.abs(t.width-r))}(r,t,e)){if(r.preferFixedSize&&e.unsafe){n(()=>`We found an image that was marked as unsafe, but it was the best size. (${e.id})`,4),o.push(e);return}r.returnAllOptions&&t&&o.push(t),n(()=>`We found a new image that was the best size. (${e.id})`,4),s=e}else r.returnAllOptions&&o.push(e)};n(()=>`The input shows we have ${t.length} list(s) of candidates to choose from.`);let u=t.length;for(let e=0;e<u;e++){let i=t[e]();n(()=>`Candidate group ${e}: ${JSON.stringify(i,null,2)}`,1);let o=i.length;n(()=>`Checking candidate list number ${e} and found ${o} potential ways of creating image(s)`,1);for(let e=0;e<o;e++){let t=i[e];n(()=>`-> Checking candidate ${e}`,1),"unknown"===t.type&&r.atAnyCost&&(n(()=>'We\'ve found an unknown image type, adding this to the "last resort" list',2),a.push(t)),"fixed"===t.type&&(t.unsafe?(n(()=>'We\'ve found an unsafe fixed image type, adding this to the "last resort" list',2),a.push(t)):(n(()=>"We've found a fixed size image, checking if it matches the request",2),l(t,s))),"fixed-service"===t.type&&(r.unsafeImageService?(n(()=>"Checking for an image from the tile source, without calculating the right height and width (unsafeImageService)",2),l(K(t,r.width,r.height),s)):(n(()=>"Checking for an image from the tile source 3",2),l(K(t,t.width,t.height),s))),"variable"===t.type&&t.maxWidth&&l(K({id:t.id,type:"fixed-service",width:t.maxWidth,height:t.maxWidth,level:t.level,version:t.version},t.maxWidth),s)}if(s&&!r.returnAllOptions){if(s.unsafe||r.allowUnsafe)continue;n(()=>`We found a match in choice list number ${e}, no searching any more`);break}}return r.atAnyCost&&0===o.length?(n(()=>s?`We found an image! ${s.id} of type ${s.type}`:'We found no images, but "atAnyCost" is set, so returning that'),{best:s||a[0],fallback:a.slice(1),log:i}):r.returnAllOptions?(n(()=>"Returning all options that we have found"),{best:r.atAnyCost?s||o[0]||a[0]:s||o[0],fallback:[...o,...a],log:i}):(n(()=>"Returning the best image that we found, and a fallback"),{best:s||o[0]||null,fallback:s?o:o.slice(1),log:i})}(t,[()=>r,()=>n])})}getImageCandidates(e,t=!0){return ea(this,null,function*(){if(t&&e.height&&e.width)for(let t of $(e)){let i={id:k(t),width:t.width?t.width:e.width,height:t.height?t.height:e.height,source:t};yield this.loadService(i)}return function(e,t=!0,i){let r=[],n=function(e){if("string"==typeof e)return F(e);let t=e["@type"]?e["@type"]:e.type?e.type:void 0;if("Image"!==t&&"sc:Image"!==t)return null;let i=k(e);return i?i&&e.width&&e.height?{id:i,type:"fixed",width:e.width,height:e.height,unsafe:!0}:F(i):null}(e);if(null===n)return r;if(r.push(n),t&&e.width&&e.height){let t=[];for(let r of $(e)){let n={id:k(r),width:e.width,height:e.height};if(i.canLoadSync(n)){let r=i.loadServiceSync(n);r&&(r.height||(r.height=e.height),r.width||(r.width=e.width),t.push(...U([r])))}}if(t.length)return r.push(...t),r}return e.service&&r.push(...U(e.service)),r}(e,t,this)})}verify(e){return ea(this,null,function*(){let t=this.predict(e,!1,!0),i=yield this.fetchService(k(e));if(!t)return!1;let r=t.height===i.height&&t.width===i.width&&t["@context"]===i["@context"]&&function(e,t){if(e.length!==t.length)return!1;if(0===e.length&&0===t.length)return!0;let i=e.length,r=!0;for(let n=0;n<i;n++){let i=e[n],a=t[n];if(i.width!==a.width||i.height!==a.height){r=!1;break}}if(r)return!0;let n=0;for(let r=0;r<i;r++)for(let a=0;a<i;a++)if(e[r].width===t[a].width&&e[r].height===t[a].height){n++;break}return n===i}(t.sizes||[],i.sizes||[]);if(r){let t=Y(k(e));this.knownImageServers[t].verifications+=1,this.knownImageServers[t].verifications>=this.config.verificationsRequired&&(this.knownImageServers[t].verified=!0)}return r})}canLoadSync(e){let t="string"==typeof e?e:k(e),i=n(t);if(this.imageServices[i])return!0;let r=this.knownImageServers[Y(t)];return r&&!r.malformed&&r.verifications>=this.config.verificationsRequired}markAsMalformed(e){return ea(this,null,function*(){return this.knownImageServers[Y(k(e))].malformed=!0,this.loadService(e,!0)})}fetchService(e,t=!1){return ea(this,null,function*(){let i=n(e);if(this.imageServices[i]&&(!t||this.imageServices[i].real))return this.imageServices[i];if(!this.config.enableFetching)throw Error("Fetching is not enabled");let r=yield this.fetch(i).then(e=>e.json());return!r.id&&r["@id"]&&(r.id=r["@id"]),r.id!==e&&(r.id=e,r["@id"]&&(r["@id"]=e)),this.imageServices[i]=Object.assign(r,{real:!0}),this.imageServices[i]})}fetch(e,t){return ea(this,null,function*(){return fetch(e,t)})}loadService(e,t=!1){return ea(this,null,function*(){if(!this.config.disableThrottling){let e=!0;for(;e;)if(this.fetchingCount>=this.config.verificationsRequired)yield new Promise(e=>setTimeout(e,500));else{e=!1;break}}let i=this.knownImageServers[Y(k(e))];if(i&&!i.malformed&&!t){yield i.result;let t=this.loadServiceSync(e);if(t)return t}this.fetchingCount++;let r=yield this.fetchService(k(e),t);return this.fetchingCount--,r.real&&this.sample(r,e),r})}loadServiceSync(e){let t=n(k(e));return this.imageServices[t]?this.imageServices[t]:this.predict(e)}}function es(e){let t=(function(e){let t=e.length%4;if(1===t)throw Error("InvalidLengthError: Input base64url string is the wrong length to determine padding");return e+(t?"====".slice(0,4-t):"")})(e).replace(/-/g,"+").replace(/_/g,"/");return decodeURIComponent("undefined"==typeof atob?r.from(t,"base64").toString("utf-8"):atob(t)).trim()}new eo,Symbol.for("_refs_"),Symbol.for("_reactive_"),Symbol.for("_defined_")},3832:function(e,t,i){"use strict";i.d(t,{j:function(){return tu}});var r=Object.defineProperty,n=(e,t,i)=>t in e?r(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,a=(e,t,i)=>(n(e,"symbol"!=typeof t?t+"":t,i),i);let o=[];Object.freeze(o);let s={id:"https://iiif-parser/annotation-page",type:"AnnotationPage",behavior:o,motivation:null,label:null,thumbnail:o,summary:null,requiredStatement:null,metadata:o,rights:null,provider:o,items:o,seeAlso:o,homepage:o,logo:o,rendering:o,service:o},l={id:"https://iiif-parser/empty-canvas",type:"Canvas",label:null,behavior:o,motivation:null,thumbnail:o,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:o,rights:null,navDate:null,provider:o,items:o,annotations:o,seeAlso:o,homepage:o,logo:o,partOf:o,rendering:o,service:o,duration:0,height:0,width:0},u={id:"https://iiif-parser/empty-collection",type:"Collection",label:null,viewingDirection:"left-to-right",behavior:o,motivation:null,thumbnail:o,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:o,rights:null,navDate:null,provider:o,items:o,annotations:o,seeAlso:o,homepage:o,logo:o,partOf:o,rendering:o,service:o,services:o},c={id:"https://iiif-parser/empty-manifest",type:"Manifest",annotations:o,behavior:o,homepage:o,items:o,label:null,logo:o,metadata:o,motivation:null,navDate:null,provider:o,partOf:o,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,rendering:o,requiredStatement:null,rights:null,seeAlso:o,service:o,services:o,start:null,structures:o,summary:null,thumbnail:o,viewingDirection:"left-to-right"},h={id:"https://iiif-parser/empty-canvas",type:"Range",label:null,behavior:o,motivation:null,thumbnail:o,posterCanvas:null,accompanyingCanvas:null,placeholderCanvas:null,summary:null,requiredStatement:null,metadata:o,rights:null,navDate:null,provider:o,items:o,annotations:o,seeAlso:o,homepage:o,logo:o,partOf:o,rendering:o,service:o,start:null,supplementary:null,viewingDirection:"left-to-right"},f={id:"https://iiif-parser/empty-agent",type:"Agent",label:{},logo:o,seeAlso:o,homepage:o};function p(e){return Array.isArray(e)?e:[e]}let d=["Collection","Manifest","Canvas","AnnotationPage","AnnotationCollection","Annotation","ContentResource","Range","Service","Selector","Agent"];class v{constructor(e,t={}){a(this,"traversals"),a(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationCollection:[],annotationPage:[],annotation:[],contentResource:[],choice:[],range:[],service:[],agent:[],...e},this.options={allowUndefinedReturn:!1,...t}}static all(e){return new v({collection:[e],manifest:[e],canvas:[e],annotationCollection:[e],annotationPage:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e]})}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=e.thumbnail.map(e=>this.traverseType(e,this.traversals.contentResource))),e.provider&&(e.provider=e.provider.map(e=>this.traverseAgent(e))),e}traverseLinking(e){return e.seeAlso&&(e.seeAlso=e.seeAlso.map(e=>this.traverseType(e,this.traversals.contentResource))),e.service&&(e.service=p(e.service).map(e=>this.traverseType(e,this.traversals.service))),e.services&&(e.services=e.services.map(e=>this.traverseType(e,this.traversals.service))),e.logo&&(e.logo=e.logo.map(e=>this.traverseType(e,this.traversals.contentResource))),e.homepage&&(e.homepage=e.homepage.map(e=>this.traverseType(e,this.traversals.contentResource))),e.partOf&&(e.partOf=e.partOf.map(e=>"string"!=typeof e&&e.type?"Canvas"===e.type?this.traverseType(e,this.traversals.canvas):"AnnotationCollection"===e.type?this.traverseType(e,this.traversals.annotationCollection):"Collection"===e.type?this.traverseType(e,this.traversals.collection):this.traverseType(e,this.traversals.contentResource):this.traverseType(e,this.traversals.contentResource))),e.start&&(e.start=e.start?this.traverseType(e.start,this.traversals.canvas):null),e.rendering&&(e.rendering=e.rendering.map(e=>this.traverseType(e,this.traversals.contentResource))),e.supplementary&&(e.supplementary=e.supplementary.map(e=>this.traverseType(e,this.traversals.contentResource))),e}traverseCollectionItems(e){return e.items&&e.items.map(e=>"Collection"===e.type?this.traverseCollection(e):this.traverseManifest(e)),e}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseInlineAnnotationPages(this.traverseLinking(this.traversePosterCanvas(this.traverseCollectionItems(e))))),this.traversals.collection)}traverseManifestItems(e){return e.items&&(e.items=e.items.map(e=>this.traverseCanvas(e))),e}traverseManifestStructures(e){return e.structures&&(e.structures=e.structures.map(e=>this.traverseRange(e))),e}traverseManifest(e){return this.traverseType(this.traverseInlineAnnotationPages(this.traverseManifestStructures(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e)))))),this.traversals.manifest)}traverseCanvasItems(e){return e.items=(e.items||[]).map(e=>this.traverseAnnotationPage(e)),e}traverseInlineAnnotationPages(e){return"string"!=typeof e&&e&&e.annotations&&(e.annotations=e.annotations.map(e=>this.traverseAnnotationPage(e))),e}traverseCanvas(e){return this.traverseType(this.traverseInlineAnnotationPages(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))))),this.traversals.canvas)}traverseAnnotationPageItems(e){return e.items&&(e.items=e.items.map(e=>this.traverseAnnotation(e))),e}traverseAnnotationPage(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationPageItems(e))),this.traversals.annotationPage)}traverseAnnotationBody(e){return Array.isArray(e.body)?e.body=e.body.map(e=>this.traverseContentResource(e)):e.body&&(e.body=this.traverseContentResource(e.body)),e}traversePosterCanvas(e){return e.posterCanvas&&(e.posterCanvas=this.traverseCanvas(e.posterCanvas)),e.placeholderCanvas&&(e.placeholderCanvas=this.traverseCanvas(e.placeholderCanvas)),e.accompanyingCanvas&&(e.accompanyingCanvas=this.traverseCanvas(e.accompanyingCanvas)),e}traverseAnnotation(e){return this.traverseType(this.traverseLinking(this.traverseAnnotationBody(e)),this.traversals.annotation)}traverseContentResourceLinking(e){return"string"!=typeof e&&e&&e&&e.service&&(e.service=p(e.service||[]).map(e=>this.traverseType(e,this.traversals.service))),e}traverseContentResource(e){return"Choice"===e.type&&(e.items=e.items.map(e=>this.traverseContentResource(e))),this.traverseType(this.traverseInlineAnnotationPages(this.traverseContentResourceLinking(e)),this.traversals.contentResource)}traverseRangeRanges(e){return e.items&&(e.items=e.items.map(e=>"string"==typeof e?this.traverseCanvas({id:e,type:"Canvas"}):"Manifest"===e.type?this.traverseManifest(e):this.traverseRange(e))),e}traverseRange(e){return this.traverseType(this.traversePosterCanvas(this.traverseDescriptive(this.traverseLinking(this.traverseRangeRanges(e)))),this.traversals.range)}traverseAgent(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.agent)}traverseType(e,t){return t.reduce((e,t)=>{let i=t(e);return void 0!==i||this.options.allowUndefinedReturn?i:e},e)}traverseService(e){return this.traverseType(e,this.traversals.service)}traverseUnknown(e){let t=function(e){if(null==e)throw Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw Error("Array is not a valid entity");if("object"!=typeof e)throw Error(`${typeof e} is not a valid entity`);if("string"==typeof e.type){let t=d.indexOf(e.type);if(-1!==t)return d[t]}if(e.profile)return"Service";throw Error("Resource type is not known")}(e);switch(t){case"Collection":return this.traverseCollection(e);case"Manifest":return this.traverseManifest(e);case"Canvas":return this.traverseCanvas(e);case"AnnotationPage":return this.traverseAnnotationPage(e);case"Annotation":return this.traverseAnnotation(e);case"ContentResource":return this.traverseContentResource(e);case"Range":return this.traverseRange(e);case"Service":return this.traverseService(e);case"Agent":return this.traverseAgent(e);default:throw Error(`Unknown or unsupported resource type of ${t}`)}}}let y=["sc:Collection","sc:Manifest","sc:Canvas","sc:AnnotationList","oa:Annotation","sc:Range","sc:Layer","sc:Sequence","oa:Choice","Service","ContentResource"];class g{constructor(e,t={}){a(this,"traversals"),a(this,"options"),this.traversals={collection:[],manifest:[],canvas:[],annotationList:[],sequence:[],annotation:[],contentResource:[],choice:[],range:[],service:[],layer:[],...e},this.options={convertPropsToArray:!0,mergeMemberProperties:!0,allowUndefinedReturn:!1,...t}}static all(e){return new g({collection:[e],manifest:[e],canvas:[e],annotationList:[e],sequence:[e],annotation:[e],contentResource:[e],choice:[e],range:[e],service:[e],layer:[e]})}traverseCollection(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCollectionItems(e))),this.traversals.collection)}traverseCollectionItems(e){if(this.options.mergeMemberProperties){let t=[...(e.manifests||[]).map(e=>"string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e),...(e.collections||[]).map(e=>"string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e),...e.members||[]];delete e.collections,delete e.manifests,e.members=t}return e.manifests&&(e.manifests=e.manifests.map(e=>this.traverseManifest("string"==typeof e?{"@id":e,"@type":"sc:Manifest"}:e))),e.collections&&(e.collections=e.collections.map(e=>this.traverseCollection("string"==typeof e?{"@id":e,"@type":"sc:Collection"}:e))),e.members&&(e.members=e.members.map(e=>"string"==typeof e?e:this.traverseUnknown(e))),e}traverseManifest(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseManifestItems(e))),this.traversals.manifest)}traverseManifestItems(e){return e.sequences&&(e.sequences=e.sequences.map(e=>this.traverseSequence(e))),e.structures&&(e.structures=e.structures.map(e=>this.traverseRange(e))),e}traverseSequence(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseSequenceItems(e))),this.traversals.sequence)}traverseSequenceItems(e){return e.canvases&&(e.canvases=e.canvases.map(e=>this.traverseCanvas(e))),e}traverseCanvas(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseCanvasItems(e))),this.traversals.canvas)}traverseCanvasItems(e){return e.images&&(e.images=e.images.map(e=>this.traverseAnnotation(e))),e.otherContent&&(e.otherContent=e.otherContent.map(e=>this.traverseAnnotationList(e))),e}traverseRange(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseRangeItems(e))),this.traversals.range)}traverseRangeItems(e){if(this.options.mergeMemberProperties){let t=[...(e.ranges||[]).map(e=>"string"==typeof e?{"@id":e,"@type":"sc:Range"}:e),...(e.canvases||[]).map(e=>"string"==typeof e?{"@id":e,"@type":"sc:Canvas"}:e),...e.members||[]];delete e.ranges,delete e.canvases,e.members=t.length?t.map(e=>this.traverseUnknown(e)):void 0}return e}traverseAnnotationList(e){return this.traverseType(this.traverseDescriptive(this.traverseAnnotationListItems("string"==typeof e?{"@id":e,"@type":"sc:AnnotationList"}:e)),this.traversals.annotationList)}traverseAnnotationListItems(e){return e.resources&&(e.resources=e.resources.map(e=>this.traverseAnnotation(e))),e}traverseAnnotation(e){return this.traverseType(this.traverseDescriptive(this.traverseLinking(this.traverseAnnotationItems(e))),this.traversals.annotation)}traverseAnnotationItems(e){return e.resource&&(Array.isArray(e.resource)?e.resource=e.resource.map(e=>this.traverseContentResource(e)):e.resource=this.traverseContentResource(e.resource)),e.on,e}traverseLayer(e){return this.traverseType(this.traverseLinking(this.traverseLayerItems(e)),this.traversals.layer)}traverseLayerItems(e){return e.otherContent&&(e.otherContent=e.otherContent.map(e=>this.traverseAnnotationList(e))),e}traverseChoice(e){return this.traverseType(this.traverseChoiceItems(e),this.traversals.choice)}traverseChoiceItems(e){return e.default&&"rdf:nil"!==e.default&&(e.default=this.traverseContentResource(e.default)),e.item&&"rdf:nil"!==e.item&&(e.item=e.item.map(e=>this.traverseContentResource(e))),e}traverseService(e){return this.traverseType(this.traverseLinking(e),this.traversals.service)}traverseContentResource(e){return"oa:Choice"===e["@type"]?this.traverseChoice(e):this.traverseType(this.traverseDescriptive(this.traverseLinking(e)),this.traversals.contentResource)}traverseUnknown(e){if(!e["@type"]||"string"==typeof e)return e;switch(function(e){if(null==e)throw Error("Null or undefined is not a valid entity.");if(Array.isArray(e))throw Error("Array is not a valid entity");if("object"!=typeof e)throw Error(`${typeof e} is not a valid entity`);if("string"==typeof e["@type"]){let t=y.indexOf(e["@type"]);if(-1!==t)return y[t]}if(e.profile)return"Service";if(e.format||e["@type"])return"ContentResource";throw Error("Resource type is not known")}(e)){case"sc:Collection":return this.traverseCollection(e);case"sc:Manifest":return this.traverseManifest(e);case"sc:Canvas":return this.traverseCanvas(e);case"sc:Sequence":return this.traverseSequence(e);case"sc:Range":return this.traverseRange(e);case"oa:Annotation":return this.traverseAnnotation(e);case"sc:AnnotationList":return this.traverseAnnotationList(e);case"sc:Layer":return this.traverseLayer(e);case"Service":return this.traverseService(e);case"oa:Choice":return this.traverseChoice(e);case"ContentResource":return this.traverseContentResource(e)}return e.profile?this.traverseService(e):e}traverseImageResource(e){let t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(let e of i)"string"==typeof e?r.push(this.traverseContentResource({"@id":e,"@type":"dctypes:Image"})):r.push(this.traverseContentResource(e));return t||this.options.convertPropsToArray?r:r[0]}traverseDescriptive(e){return e.thumbnail&&(e.thumbnail=this.traverseImageResource(e.thumbnail)),e.logo&&(e.logo=this.traverseImageResource(e.logo)),e}traverseOneOrMoreServices(e){let t=Array.isArray(e),i=Array.isArray(e)?e:[e],r=[];for(let e of i)r.push(this.traverseService(e));return t||this.options.convertPropsToArray?r:r[0]}traverseLinking(e){return e.related&&(e.related=this.traverseOneOrManyType(e.related,this.traversals.contentResource)),e.rendering&&(e.rendering=this.traverseOneOrManyType(e.rendering,this.traversals.contentResource)),e.service&&(e.service=this.traverseOneOrMoreServices(e.service)),e.seeAlso&&(e.seeAlso=this.traverseOneOrManyType(e.seeAlso,this.traversals.contentResource)),e.within&&("string"==typeof e.within||(e.within=this.traverseOneOrManyType(e.within,this.traversals.contentResource))),e.startCanvas&&("string"==typeof e.startCanvas?e.startCanvas=this.traverseType({"@id":e.startCanvas,"@type":"sc:Canvas"},this.traversals.canvas):e.startCanvas&&this.traverseType(e.startCanvas,this.traversals.canvas)),e.contentLayer&&("string"==typeof e.contentLayer?e.contentLayer=this.traverseLayer({"@id":e.contentLayer,"@type":"sc:Layer"}):e.contentLayer=this.traverseLayer(e.contentLayer)),e}traverseOneOrManyType(e,t){if(!Array.isArray(e)){if(!this.options.convertPropsToArray)return this.traverseType(e,t);e=[e]}return e.map(e=>this.traverseType(e,t))}traverseType(e,t){return t.reduce((e,t)=>{let i=t(e);return void 0!==i||this.options.allowUndefinedReturn?i:e},e)}}let m="http://library.stanford.edu/iiif/image-api/compliance.html#level1",b="http://library.stanford.edu/iiif/image-api/compliance.html#level2",A="http://library.stanford.edu/iiif/image-api/conformance.html#level1",w="http://library.stanford.edu/iiif/image-api/conformance.html#level2",x="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level1",C="http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2",S="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level1",O="http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level2",R="http://iiif.io/api/image/1/level1.json",j="http://iiif.io/api/image/1/profiles/level1.json",E="http://iiif.io/api/image/1/level2.json",I="http://iiif.io/api/image/1/profiles/level2.json",T="http://iiif.io/api/image/2/level1.json",k="http://iiif.io/api/image/2/profiles/level1.json",P="http://iiif.io/api/image/2/level2.json",M="http://iiif.io/api/image/2/profiles/level2.json",L="level1",D="level2",F="http://iiif.io/api/image/2/level1",U="http://iiif.io/api/image/2/level2",$=[F,U,m,b,A,w,x,C,S,O,R,j,E,I,T,k,P,M,L,D],q=["http://iiif.io/api/image/2/level0",F,U,"http://library.stanford.edu/iiif/image-api/compliance.html#level0",m,b,"http://library.stanford.edu/iiif/image-api/conformance.html#level0",A,w,"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0",x,C,"http://library.stanford.edu/iiif/image-api/1.1/conformance.html#level0",S,O,"http://iiif.io/api/image/1/level0.json","http://iiif.io/api/image/1/profiles/level0.json",R,j,E,I,"http://iiif.io/api/image/2/level0.json","http://iiif.io/api/image/2/profiles/level0.json",T,k,P,M,"level0",L,D],W={attributionLabel:"Attribution",providerId:"http://example.org/provider",providerName:"Unknown"};function _(e,t="none"){if(!e)return{};let i=Array.isArray(e)?e:[e],r={};for(let e of i){if("string"==typeof e){r[t]=r[t]?r[t]:[],r[t].push(e||"");continue}if(!e["@language"]){r[t]=r[t]?r[t]:[],r[t].push(e["@value"]||"");continue}let i=e["@language"];r[i]=r[i]?r[i]:[],r[i].push(e["@value"]||"")}return r}function B(e){for(let t of["sc","oa","dcterms","dctypes","iiif"])if(e.startsWith(`${t}:`))return e.slice(t.length+1);return e}let N=["Collection","Manifest","Annotation","AnnotationPage","Range","Service"];function z(e){let t=e["@id"]||e.id,i=e["@type"]||e.type,r=e.profile||void 0,n=e["@context"]||void 0;if(r){let e=function(e){switch(e){case"http://iiif.io/api/image/2/level0.json":case"http://iiif.io/api/image/2/level1.json":case"http://iiif.io/api/image/2/level2.json":return"ImageService2";case"http://iiif.io/api/auth/1/kiosk":case"http://iiif.io/api/auth/1/login":case"http://iiif.io/api/auth/1/clickthrough":case"http://iiif.io/api/auth/1/external":case"http://iiif.io/api/auth/0/kiosk":case"http://iiif.io/api/auth/0/login":case"http://iiif.io/api/auth/0/clickthrough":case"http://iiif.io/api/auth/0/external":return"AuthCookieService1";case"http://iiif.io/api/auth/1/token":case"http://iiif.io/api/auth/0/token":return"AuthTokenService1";case"http://iiif.io/api/auth/1/logout":case"http://iiif.io/api/auth/0/logout":return"AuthLogoutService1";case"http://iiif.io/api/search/1/search":case"http://iiif.io/api/search/0/search":return"SearchService1";case"http://iiif.io/api/search/1/autocomplete":case"http://iiif.io/api/search/0/autocomplete":return"AutoCompleteService1"}}(r);if(e)return e}if(n){let e=function(e){for(let t of Array.isArray(e)?e:[e])switch(t){case"http://iiif.io/api/image/2/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level2":return"ImageService2";case"http://iiif.io/api/image/1/context.json":case"http://library.stanford.edu/iiif/image-api/1.1/context.json":return"ImageService1";case"http://iiif.io/api/annex/openannotation/context.json":return"ImageApiSelector"}}(n);if(e)return e}if(i){if(Array.isArray(i)){if(-1!==i.indexOf("oa:CssStylesheet"))return"CssStylesheet";if(-1!==i.indexOf("cnt:ContentAsText"))return"TextualBody";i=i[0]}for(let e of["sc","oa","dcterms","dctypes","iiif"])if(i.startsWith(`${e}:`)){i=i.slice(e.length+1);break}switch(i){case"Layer":return"AnnotationCollection";case"AnnotationList":return"AnnotationPage";case"cnt:ContentAsText":return"TextualBody"}}if(i&&-1!==N.indexOf(i))return i;if(e.format){if(e.format.startsWith("image/"))return"Image";if(e.format.startsWith("text/")||"application/pdf"===e.format)return"Text";if(e.format.startsWith("application/"))return"Dataset"}return t&&(t.endsWith(".jpg")||t.endsWith(".png")||t.endsWith(".jpeg"))?"Image":i||"unknown"}let Q=/http(s)?:\/\/(creativecommons.org|rightsstatements.org)[^"'\\<\n]+/gm,H=["http://iiif.io/api/presentation/2/context.json","http://iiif.io/api/image/2/context.json","http://iiif.io/api/image/1/context.json","http://library.stanford.edu/iiif/image-api/1.1/context.json","http://iiif.io/api/search/1/context.json","http://iiif.io/api/search/0/context.json","http://iiif.io/api/auth/1/context.json","http://iiif.io/api/auth/0/context.json","http://iiif.io/api/annex/openannotation/context.json"];function V(e){for(let t in e)(void 0===e[t]||null===e[t])&&delete e[t];return e}let K=0;function Y(e,t){let i=encodeURI(e.id||e["@id"]||"").trim();return i&&t?`${i}/${t}`:i||(K++,`http://example.org/${e["@type"]}${t?`/${t}`:""}/${K}`)}function G(e){let t;let i=[...e.behavior||[]];return e.viewingHint&&i.push(e.viewingHint),Array.isArray(e.motivation)?t=e.motivation.map(B):e.motivation&&(t=B(e.motivation)),{"@context":e["@context"]?function(e){if(e){let t=Array.isArray(e)?e:[e],i=[];for(let e of t)"http://iiif.io/api/presentation/2/context.json"===e&&i.push("http://iiif.io/api/presentation/3/context.json"),-1===H.indexOf(e)&&i.push(e);if(t.length)return 1===i.length?i[0]:i}}(e["@context"]):void 0,id:(e["@id"]||Y(e)).trim(),type:z(e),behavior:i.length?i:void 0,height:e.height?e.height:void 0,width:e.width?e.width:void 0,motivation:t,viewingDirection:e.viewingDirection,profile:e.profile,format:e.format?e.format:void 0,duration:void 0,timeMode:void 0}}function J(e){var t;let[i,r]=function(e,t="Rights/License",i="none"){let r=null,n=[];for(let a of Array.isArray(e)?e:[e]){let e=a?function(e){let t=e.match(Q);return t?t[0]:e}(a):void 0;if(e&&(-1!==e.indexOf("creativecommons.org")||-1!==e.indexOf("rightsstatements.org"))){r=e.startsWith("https://")?`http://${e.slice(8)}`:e;continue}e&&n.push({label:{[i]:[t]},value:{[i]:[e]}})}return[r,n]}(e.license),n=[...e.metadata&&(t=e.metadata)?t.map(e=>({label:_(e.label),value:_(e.value)})):[],...r];return{rights:i,metadata:n.length?n:void 0,label:e.label?_(e.label):void 0,requiredStatement:e.attribution?{label:_(W.attributionLabel),value:_(e.attribution)}:void 0,navDate:e.navDate,summary:e.description?_(e.description):void 0,thumbnail:e.thumbnail}}function X(e){let t=e.related?Array.isArray(e.related)?e.related:[e.related]:[],i=e.contentLayer;return{provider:e.logo||t.length?[{id:W.providerId,type:"Agent",homepage:t.length?[t[0]]:void 0,logo:e.logo?Array.isArray(e.logo)?e.logo:[e.logo]:void 0,label:_(W.providerName)}]:void 0,partOf:function(e){if(!e.within)return;let t=Array.isArray(e.within)?e.within:[e.within],i=[];for(let r of t)"string"==typeof r?r&&"sc:Manifest"===e["@type"]&&i.push({id:r,type:"Collection"}):r["@id"]&&i.push({id:r["@id"],type:z(r)});return i.length?i:void 0}(e),rendering:e.rendering,seeAlso:e.seeAlso,start:e.startCanvas,service:e.service?p(e.service):void 0,supplementary:i?[i]:void 0}}function Z(e){return V({...G(e),...J(e),...X(e),chars:e.chars,format:e.format?e.format:void 0,language:e.language})}let ee=new g({collection:[function(e){return V({...G(e),...J(e),...X(e),items:e.members})}],manifest:[function(e){let t=[],i=[];for(let r of e.sequences||[])r.canvases.length&&t.push(...r.canvases),r.behavior&&i.push(...r.behavior);let r=G(e);return i.length&&(r.behavior?r.behavior.push(...i):r.behavior=i),V({...r,...J(e),...X(e),items:t,structures:e.structures})}],canvas:[function(e){return V({...G(e),...J(e),...X(e),annotations:e.otherContent&&e.otherContent.length?e.otherContent:void 0,items:e.images&&e.images.length?[{id:Y(e,"annotation-page"),type:"AnnotationPage",items:e.images}]:void 0})}],annotationList:[function(e){return V({...G(e),...J(e),...X(e),items:e.resources&&e.resources.length?e.resources:void 0})}],sequence:[function(e){return e.canvases&&0!==e.canvases.length?{canvases:e.canvases,behavior:e.viewingHint?[e.viewingHint]:[]}:{canvases:[],behavior:[]}}],annotation:[function(e){return V({...G(e),...J(e),...X(e),target:function e(t){if(Array.isArray(t)){if(t.length>1)return{type:"List",items:t.map(e)};t=t[0]}if("string"==typeof t)return encodeURI(t).trim();if(!("@type"in t))return encodeURI(t["@id"]).trim();{let e;if("string"==typeof t.full)e=t.full;else if("dctypes:Image"===t.full["@type"])e={id:t.full["@id"],type:"Image"};else if("sc:Canvas"===t.full["@type"])e={id:t.full["@id"],type:"Canvas"};else throw Error(`Unsupported source type on annotation: ${t.full["@type"]}`);return{type:"SpecificResource",source:e,selector:function e(t){if((Array.isArray(t["@type"])&&t["@type"].includes("oa:SvgSelector")||"oa:SvgSelector"==t["@type"])&&("chars"in t||"value"in t))return{type:"SvgSelector",value:"chars"in t?t.chars:t.value};if("oa:FragmentSelector"===t["@type"])return{type:"FragmentSelector",value:t.value};if("oa:Choice"===t["@type"])return[e(t.default),...(Array.isArray(t.item)?t.item:[t.item]).map(e)];if("iiif:ImageApiSelector"==t["@type"])return{type:"ImageApiSelector",region:"region"in t?t.region:void 0,rotation:"rotation"in t?t.rotation:void 0};throw Error(`Unsupported selector type: ${t["@type"]}`)}(t.selector)}}}(e.on),body:Array.isArray(e.resource)?e.resource.map(Z):Z(e.resource)})}],contentResource:[Z],choice:[function(e){let t=[];return e.default&&"rdf:nil"!==e.default&&t.push(e.default),e.item&&"rdf:nil"!==e.item&&t.push(...e.item),{...G(e),...J(e),items:t}}],range:[function(e){return V({...G(e),...J(e),...X(e),items:e.members})}],service:[function(e){let{"@id":t,"@type":i,"@context":r,profile:n,...a}=e,o={};return t&&(o["@id"]=t),o["@type"]=z(e),"unknown"===o["@type"]&&(r&&r.length&&(o["@context"]=r),o["@type"]="Service"),n&&(o.profile=function e(t){return Array.isArray(t)?e(t.find(e=>"string"==typeof e)):-1!==q.indexOf(t)?"level2":-1!==$.indexOf(t)?"level1":"string"==typeof t?t:void 0}(n)),V({...o,...a})}],layer:[function(e){return V({...G(e),...J(e),...X(e)})}]});function et(e,t){if("string"==typeof e)return{id:e,type:t};if(!e.id)throw Error(`Invalid resource does not have an ID (${t})`);return e}function ei(e){return t=>"string"==typeof t?{id:t,type:e}:t.id?t.type?t:{type:e,...t}:{id:`vault://${function(e){let t=JSON.stringify(e),i=5381,r=t.length;for(;r;)i=33*i^t.charCodeAt(--r);let n=(i>>>0).toString(16);return n.length%2?"0"+n:n}(t)}`,type:e,...t}}function er(e){return t=>({...e,...t})}function en(e){return Array.isArray(e)?e:[e]}function ea(e){return e.body&&(e.body=en(e.body)),e.seeAlso&&(e.seeAlso=en(e.seeAlso)),e.body&&(e.body=en(e.body)),e.audience&&(e.audience=en(e.audience)),e.accessibility&&(e.accessibility=en(e.accessibility)),e.motivation&&(e.motivation=en(e.motivation)),e}let eo="__$UNSET$__",es="__$UNWRAP$__";function el(e){if(!e)return;let t=Object.keys(e);if(0!==t.length){if(1===t.length){let i=t[0];if(!i)return"";let r=(e[i]||[]).join("");return"@none"===i||"none"===i||"en"===i?r:{"@language":i,"@value":r}}return t.map(t=>({"@language":t,"@value":(e[t]||[]).join("")}))}}function eu(e,t=!1){return e?e.length>1&&!t?e:e[0]||void 0:void 0}function ec(e){if(e){if("string"==typeof e)return{"@id":e};if("@id"in e){let t={...e};return delete t["@type"],t}return{"@context":"http://iiif.io/api/image/2/context.json","@id":e.id,profile:`http://iiif.io/api/image/2/profiles/${e.profile}.json`}}}function eh(e,t){return[["@id",e.id],["@type",t],["format",e.format],["height",e.height],["width",e.width],["viewingDirection","left-to-right"!==e.viewingDirection?e.viewingDirection:void 0]]}function*ef(e){let t=e.provider?yield e.provider[0]:void 0;return[["label",el(e.label)],["metadata",e.metadata&&e.metadata.length?e.metadata.map(e=>({label:el(e.label)||"",value:el(e.value)||""})):void 0],["description",el(e.summary)],["thumbnail",eu((yield e.thumbnail))],["navDate",e.navDate],["logo",t?eu(t.logo):void 0],["homepage",t?t.homepage:void 0],["attribution",e.requiredStatement?el(e.requiredStatement.value):void 0]]}function*ep(e){return[["seeAlso",eu((yield e.seeAlso))],["service",eu((e.service||[]).map(ec))],["rendering",eu((yield e.rendering))],["startCanvas",e.start?e.start.id:void 0]]}let ed={Manifest:function*(e){return[...eh(e,"sc:Manifest"),...yield*ef(e),...yield*ep(e),["sequences",[{"@id":`${e.id}/sequence0`,"@type":"sc:Sequence",canvases:yield e.items}]],["structures",(yield e.structures)]]},Canvas:function*(e){let t=(yield e.items)[0];return[...eh(e,"sc:Canvas"),...yield*ef(e),...yield*ep(e),["images",t?[t.resources]:void 0],["annotations",e.annotations&&e.annotations.length?eu((yield e.annotations)):void 0]]},AnnotationPage:function*(e){return[...eh(e,"sc:AnnotationList"),...yield*ef(e),["resources",e.items&&e.items.length?eu((yield e.items)):void 0]]},Annotation:function*(e){return[["@id",e.id],["@type","oa:Annotation"],["motivation","sc:painting"],["on",function e(t){return Array.isArray(t)?t.map(t=>e(t)):"string"==typeof t?t:t.type&&"Canvas"===t.type?t.id:t}(e.target)],["resource",eu((yield e.body),!0)]]},ContentResource:function*(e){return"Image"===e.type?[...eh(e,"dctypes:Image"),...yield*ef(e),...yield*ep(e)]:[...eh(e,void 0),...yield*ef(e)]},AnnotationCollection:function*(e){return[["@id",e.id],["@type","sc:Layer"],["label",el(e.label)]]},Collection:function*(e){return[...eh(e,"sc:Collection"),...yield*ef(e),...yield*ep(e),["members",(yield*e.items)]]},Range:function*(e){let t=[],i=[];if(e.items)for(let r of e.items){let n=yield r;t.push({"@id":r.id,"@type":r.type,label:n?n.label:void 0,within:e.id}),"Canvas"===r.type&&i.push(r.id)}return[...eh(e,"sc:Range"),...yield*ef(e),...yield*ep(e),["canvases",i.length===t.length?i:void 0],["members",i.length!==t.length?t:void 0]]}};function ev(e){var t;return[["id",(null==(t=e.id)?void 0:t.startsWith("vault://"))?void 0:e.id],["type",e.type],["format",e.format],["profile",e.profile],["height",e.height],["width",e.width],["duration",e.duration||void 0],["viewingDirection","left-to-right"!==e.viewingDirection?e.viewingDirection:void 0],["behavior",e.behavior&&e.behavior.length?e.behavior:void 0],["timeMode",e.timeMode],["motivation",Array.isArray(e.motivation)?e.motivation[0]:e.motivation]]}function ey(e){if(e&&0!==e.length)return e}function eg(e){if(e&&e.type&&"ImageService2"===e.type){let{id:t,type:i,profile:r,...n}=e,a="string"==typeof r?r:Array.isArray(r)?r.find(e=>"string"==typeof e):"";return{"@id":t,"@type":i,profile:a?a.startsWith("http")?a:`http://iiif.io/api/image/2/${a}.json`:"http://iiif.io/api/image/2/level0.json",...n}}return e}function em(e){if(e&&0!==e.length)return e.map(eg)}function*eb(e){return[["label",e.label],["metadata",ey(e.metadata)],["summary",e.summary],["requiredStatement",e.requiredStatement],["rights",e.rights],["navDate",e.navDate],["language",e.language],["thumbnail",ey((yield e.thumbnail))],["placeholderCanvas",(yield e.placeholderCanvas)],["accompanyingCanvas",(yield e.accompanyingCanvas)],["provider",ey((yield e.provider))]]}function*eA(e){return[["seeAlso",ey((yield e.seeAlso))],["service",em(e.service)],["services",em(e.services)],["rendering",ey((yield e.rendering))],["supplementary",ey((yield e.supplementary))],["homepage",ey((yield e.homepage))],["logo",ey((yield e.logo))],["partOf",ey((yield e.partOf))],["start",e.start]]}let ew={Manifest:function*(e,t,{isTopLevel:i}){return i?[["@context","http://iiif.io/api/presentation/3/context.json"],...ev(e),...yield*eb(e),...yield*eA(e),["items",(yield e.items)],["structures",ey((yield e.structures))],["annotations",ey((yield e.annotations))]]:[...ev(e),...yield*eb(e)]},Canvas:function*(e){return[...ev(e),...yield*eb(e),...yield*eA(e),["items",(yield e.items)],["annotations",ey((yield e.annotations))]]},Agent:function*(e){return[["id",e.id],["type","Agent"],["label",e.label],...yield*eA(e)]},AnnotationPage:function*(e){return[...Object.entries(e).map(([e,t])=>[e,Array.isArray(t)?ey(t):t]).filter(([e,t])=>"items"!==e),...yield*eA(e),["items",(yield e.items)]]},Service:function*(e){return[[es,eg(e)]]},Annotation:function*(e){let t=Object.entries(e).map(([e,t])=>"motivation"===e?[e,Array.isArray(t)?t[0]:t]:[e,Array.isArray(t)?ey(t):t]).filter(([e])=>"body"!==e),i=yield e.body;return[...t,["body",1===i.length?i[0]:i]]},ContentResource:function*(e){return[...ev(e),...yield*eb(e),...yield*eA(e),["annotations",ey((yield e.annotations))],["items",ey((yield e.items))]]},AnnotationCollection:function*(e){return[["id",e.id],["type","AnnotationCollection"],["label",e.label]]},Collection:function*(e,t,{isTopLevel:i}){return i?[["@context","http://iiif.io/api/presentation/3/context.json"],...ev(e),...yield*eb(e),...yield*eA(e),["items",ey((yield e.items))]]:[...ev(e),...yield*eb(e)]},Range:function*(e){let t=[];for(let i of e.items)"Range"===i.type?t.push((yield i)):t.push(i);return[...ev(e),...yield*eb(e),...yield*eA(e),["items",t],["annotations",ey((yield e.annotations))]]}};var ex=i(1518);function eC(e){return(eC="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function eS(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),i.push.apply(i,r)}return i}function eO(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?eS(Object(i),!0).forEach(function(t){!function(e,t,i){var r;r=function(e,t){if("object"!=eC(e)||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=eC(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"),(t="symbol"==eC(r)?r:String(r))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}(e,t,i[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):eS(Object(i)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))})}return e}function eR(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var ej="function"==typeof Symbol&&Symbol.observable||"@@observable",eE=function(){return Math.random().toString(36).substring(7).split("").join(".")},eI={INIT:"@@redux/INIT"+eE(),REPLACE:"@@redux/REPLACE"+eE(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+eE()}};function eT(e){for(var t,i=Object.keys(e),r={},n=0;n<i.length;n++){var a=i[n];"function"==typeof e[a]&&(r[a]=e[a])}var o=Object.keys(r);try{!function(e){Object.keys(e).forEach(function(t){var i=e[t];if(void 0===i(void 0,{type:eI.INIT}))throw Error(eR(12));if(void 0===i(void 0,{type:eI.PROBE_UNKNOWN_ACTION()}))throw Error(eR(13))})}(r)}catch(e){t=e}return function(e,i){if(void 0===e&&(e={}),t)throw t;for(var n=!1,a={},s=0;s<o.length;s++){var l=o[s],u=r[l],c=e[l],h=u(c,i);if(void 0===h)throw i&&i.type,Error(eR(14));a[l]=h,n=n||h!==c}return(n=n||o.length!==Object.keys(e).length)?a:e}}function ek(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce(function(e,t){return function(){return e(t.apply(void 0,arguments))}})}function eP(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return function(e){return function(){var i=e.apply(void 0,arguments),r=function(){throw Error(eR(15))},n={getState:i.getState,dispatch:function(){return r.apply(void 0,arguments)}},a=t.map(function(e){return e(n)});return r=ek.apply(void 0,a)(i.dispatch),eO(eO({},i),{},{dispatch:r})}}}let eM="@iiif/IMPORT_ENTITIES",eL="@iiif/MODIFY_ENTITY_FIELD",eD="@iiif/REORDER_ENTITY_FIELD",eF="@iiif/ADD_REFERENCE",eU="@iiif/REMOVE_REFERENCE",e$=(0,ex.createAction)(eM)(),eq=(0,ex.createAction)(eL)(),eW={importEntities:e$,modifyEntityField:eq,reorderEntityField:(0,ex.createAction)(eD)(),addReference:(0,ex.createAction)(eF)(),removeReference:(0,ex.createAction)(eU)()},e_="@iiif/ADD_MAPPING",eB="@iiif/ADD_MAPPINGS",eN=(0,ex.createAction)(e_)(),ez=(0,ex.createAction)(eB)(),eQ="@iiif/SET_META_VALUE",eH="@iiif/SET_META_VALUE_DYNAMIC",eV="@iiif/UNSET_META_VALUE",eK={setMetaValue:(0,ex.createAction)(eQ)(),setMetaValueDynamic:(0,ex.createAction)(eH)(),unsetMetaValue:(0,ex.createAction)(eV)()},eY="RESOURCE_ERROR",eG="RESOURCE_LOADING",eJ="RESOURCE_READY",eX="@iiif/REQUEST_RESOURCE",eZ="@iiif/REQUEST_ERROR",e0="@iiif/REQUEST_MISMATCH",e1="@iiif/REQUEST_COMPLETE",e2="@iiif/REQUEST_OFFLINE_RESOURCE",e3=(0,ex.createAction)(eX)(),e6=(0,ex.createAction)(eZ)(),e4=(0,ex.createAction)(e0)(),e5=(0,ex.createAction)(e1)();(0,ex.createAction)(e2)();let e8="@iiif/BATCH",e9="@iiif/BATCH_IMPORT",e7=(0,ex.createAction)(e8)();(0,ex.createAction)(e9)();let te=(e,t)=>{let{entities:i,resource:r,mapping:n}=function(e){let t=e&&e["@context"]&&("http://iiif.io/api/presentation/2/context.json"===e["@context"]||-1!==e["@context"].indexOf("http://iiif.io/api/presentation/2/context.json")||"http://www.shared-canvas.org/ns/context.json"===e["@context"])||"http://iiif.io/api/image/2/context.json"===e["@context"]?ee.traverseUnknown(e):e,i={Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}},r={},n=(e,t)=>{let r=i[e]?i[e]:{};return i=>{let n=et(i,t||e);return n&&n.id&&e?(r[n.id]=r[n.id]?function(e,t){if("string"==typeof e)return e;if(t.id!==e.id||t.type!==e.type)throw Error("Can only merge entities with identical identifiers and type!");return function e(t,i){if(!i)return t;if(Array.isArray(t)){if(!Array.isArray(i))throw Error("Cannot merge array with non-array");let r=[...t];for(let n of i)if(null!=n){if(Array.isArray(n))r.push(n);else if("object"==typeof n&&n.id&&n.type){let t=r.findIndex(e=>e.id===n.id&&e.type===n.type);t>=0&&(r[t]=e(r[t],n))}else -1===t.indexOf(n)&&r.push(n)}return r}if("object"==typeof t){if(Array.isArray(i)||"object"!=typeof i)throw Error("Cannot merge object with non-object");let r={...t};for(let[t,n]of Object.entries(i)){let i=r[t];i!==o&&i?r[t]=e(i,n):r[t]=n}return r}return t||i}({...e},t)}(r[n.id],n):Object.assign({},n),{id:n.id,type:"ContentResource"===e?e:n.type}):n}},a=(e,t)=>i=>{let{id:n,type:a}=et(i,t||e);if(void 0===n)throw Error("Found invalid entity without an ID.");return"ContentResource"===e?r[n]=e:r[n]=a,i};return{entities:i,resource:new v({collection:[er(u),a("Collection"),n("Collection")],manifest:[er(c),a("Manifest"),n("Manifest")],canvas:[er(l),a("Canvas"),n("Canvas")],annotationPage:[ei("AnnotationPage"),er(s),a("AnnotationPage"),n("AnnotationPage")],annotation:[ei("Annotation"),ea,a("Annotation"),n("Annotation")],contentResource:[ei("ContentResource"),a("ContentResource"),n("ContentResource")],range:[er(h),a("Range","Canvas"),n("Range","Canvas")],agent:[er(f),a("Agent"),n("Agent")]}).traverseUnknown(t),mapping:r}}(t);if(void 0===r.id)return[e6({id:e,message:"ID is not defined in resource."})];let a=[e$({entities:i}),ez({mapping:n})];return r.id!==e&&(a.push(eN({id:e,type:r.type})),a.push(e4({requestId:e,actualId:r.id}))),a.push(e5({id:e})),a},tt=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function ti(e,t){if(!Array.isArray(e)||!Array.isArray(t))return e===t;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++){var i,r;if(!((i=e[n])===(r=t[n])||tt(i)&&tt(r)))return!1}return!0}function tr(e,t){let i=e.iiif.requests[t],r=e.iiif.mapping[t];if(r&&e.iiif.entities[r][i.resourceUri])return e.iiif.entities[r][i.resourceUri]}function tn(e,t,{waitTimeout:i=30}={}){return async(r,n)=>{let a=e.getState(),o=a.iiif.requests[r];if(o)switch(o.loadingState){case eY:break;case eG:{let t;let n=!1;try{let a=await Promise.race([new Promise((i,a)=>{n||(t=e.subscribe(()=>{let t=e.getState();if(t.iiif.requests[r].loadingState===eY){a();return}if(t.iiif.requests[r].loadingState===eJ){let e=tr(t,r);e?i(e):a()}}))}),new Promise((e,t)=>setTimeout(()=>{n=!0,t()},60*i))]);if(t&&t(),a)return a}catch(e){t&&t()}break}case eJ:{let e=tr(a,r);if(e)return e}}e.dispatch(e3({id:r}));try{let i=await t(r,n);i.id||i["@id"]||(i["@type"]&&(i["@id"]=r),i.id=r);let a=te(r,i);return e.dispatch(e7({actions:a})),tr(e.getState(),r)}catch(t){throw e.dispatch(e6({id:r,message:t.toString()})),t}}}function ta(){return{Collection:{},Manifest:{},Canvas:{},AnnotationPage:{},AnnotationCollection:{},Annotation:{},ContentResource:{},Range:{},Service:{},Selector:{},Agent:{}}}function to(e,t,i,r){return!(!e[i]||!e[i][t]||!e[i][t][r]||!Array.isArray(e[i][t][r]))}let ts=eT({mapping:(e={},t)=>{switch(t.type){case e_:return{...e,[t.payload.id]:t.payload.type};case eB:return{...e,...t.payload.mapping};default:return e}},entities:(e=ta(),t)=>{switch(t.type){case eL:{if(!e[t.payload.type]||!e[t.payload.type][t.payload.id])return e;let i=e[t.payload.type][t.payload.id];if("string"==typeof i)return e;return{...e,[t.payload.type]:{...e[t.payload.type],[t.payload.id]:{...i,[t.payload.key]:t.payload.value}}}}case eD:{if(!to(e,t.payload.id,t.payload.type,t.payload.key))return e;let i=e[t.payload.type][t.payload.id];if("string"==typeof i)return e;let r=Array.from(i[t.payload.key]),[n]=r.splice(t.payload.startIndex,1);return r.splice(t.payload.endIndex,0,n),{...e,[t.payload.type]:{...e[t.payload.type],[t.payload.id]:{...i,[t.payload.key]:r}}}}case eM:{let i=Object.keys(t.payload.entities),r={...e};for(let n of i){let i=t.payload.entities[n],a={...e[n]||{}},o=!1,s=Object.keys(i||{})||[];if(i&&s){for(let t of s)o=!0,a[t]=e[n][t]?function(e,t){let i={},r=[];for(let[n,a]of Object.entries(e||{})){r.push(n);let e=(t||{})[n];if(!e||0===e.length){i[n]=a;continue}i[n]=e}for(let[e,n]of Object.entries(t||{}))-1===r.indexOf(e)&&(i[e]=n);return i}(e[n][t],i[t]):i[t];o&&(r[n]=a)}}return r}case eF:{if(!to(e,t.payload.id,t.payload.type,t.payload.key))return e;let i=e[t.payload.type][t.payload.id],r=Array.from(i[t.payload.key]);return r.splice(t.payload.index||r.length+1,0,t.payload.reference),{...e,[t.payload.type]:{...e[t.payload.type],[t.payload.id]:{...i,[t.payload.key]:r}}}}case eU:{if(!to(e,t.payload.id,t.payload.type,t.payload.key))return e;let i=e[t.payload.type][t.payload.id],r=Array.from(i[t.payload.key]),n=t.payload.index||r.findIndex(e=>e&&e.id===t.payload.reference.id);if(-1===n||r[n]?.id!==t.payload.reference.id)return e;return r.splice(n,1),{...e,[t.payload.type]:{...e[t.payload.type],[t.payload.id]:{...i,[t.payload.key]:r}}}}default:return e}},requests:(e={},t)=>{switch(t.type){case eX:case e2:return{...e,[t.payload.id]:{requestUri:t.payload.id,loadingState:eG,uriMismatch:!1,resourceUri:t.payload.id}};case e0:return{...e,[t.payload.requestId]:{...e[t.payload.requestId]||{},uriMismatch:!0,resourceUri:t.payload.actualId},[t.payload.actualId]:{requestUri:t.payload.requestId,loadingState:e[t.payload.requestId].loadingState,uriMismatch:!0,resourceUri:t.payload.actualId}};case eZ:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:eY,error:t.payload.message}};case e1:return{...e,[t.payload.id]:{...e[t.payload.id]||{},loadingState:eJ,error:void 0}}}return e},meta:(e={},t)=>{let{id:i,updateValue:r,value:n,meta:a,key:o}=t&&t.payload||{};switch(t.type){case eQ:return{...e,[i]:{...e[i]||{},[a]:{...e[i]&&e[i][a]||{},[o]:n}}};case eH:return{...e,[i]:{...e[i]||{},[a]:{...e[i]&&e[i][a]||{},[o]:r(e[i]&&e[i][a]?e[i][a][o]:void 0)}}};case eV:if(e[i]&&e[i][a]&&e[i][a][o])return{...e,[i]:{...e[i]||{},[a]:{...e[i]&&e[i][a]||{},[o]:void 0}}};return e;default:return e}}}),tl="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||ek;class tu{options;store;emitter;isBatching=!1;batchQueue=[];remoteFetcher;staticFetcher;constructor(e,t){var i;this.options=Object.assign({reducers:{},middleware:[],defaultState:{},customFetcher:this.defaultFetcher,enableDevtools:!0},e||{}),this.store=t||function(e={}){var t;let{enableDevtools:i=!0,iiifStoreName:r="iiif",defaultState:n={},extraMiddleware:a=[],customReducers:o={}}=e;return function e(t,i,r){if("function"==typeof i&&"function"==typeof r||"function"==typeof r&&"function"==typeof arguments[3])throw Error(eR(0));if("function"==typeof i&&void 0===r&&(r=i,i=void 0),void 0!==r){if("function"!=typeof r)throw Error(eR(1));return r(e)(t,i)}if("function"!=typeof t)throw Error(eR(2));var n,a=t,o=i,s=[],l=s,u=!1;function c(){l===s&&(l=s.slice())}function h(){if(u)throw Error(eR(3));return o}function f(e){if("function"!=typeof e)throw Error(eR(4));if(u)throw Error(eR(5));var t=!0;return c(),l.push(e),function(){if(t){if(u)throw Error(eR(6));t=!1,c();var i=l.indexOf(e);l.splice(i,1),s=null}}}function p(e){if(!function(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}(e))throw Error(eR(7));if(void 0===e.type)throw Error(eR(8));if(u)throw Error(eR(9));try{u=!0,o=a(o,e)}finally{u=!1}for(var t=s=l,i=0;i<t.length;i++)(0,t[i])();return e}return p({type:eI.INIT}),(n={dispatch:p,subscribe:f,getState:h,replaceReducer:function(e){if("function"!=typeof e)throw Error(eR(10));a=e,p({type:eI.REPLACE})}})[ej]=function(){var e;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw Error(eR(11));function t(){e.next&&e.next(h())}return t(),{unsubscribe:f(t)}}})[ej]=function(){return this},e},n}((t=eT({[r]:ts,...o}),(e,i)=>i&&i.type===e8?i.payload.actions.reduce(t,e):i&&i.type===e9?i.payload.state:t(e,i)),n,i?tl(eP(...a)):ek(eP(...a)))}({customReducers:this.options.reducers,extraMiddleware:[...this.options.middleware,this.middleware],defaultState:this.options.defaultState,enableDevtools:this.options.enableDevtools}),this.emitter={all:i=i||new Map,on:function(e,t){var r=i.get(e);r?r.push(t):i.set(e,[t])},off:function(e,t){var r=i.get(e);r&&(t?r.splice(r.indexOf(t)>>>0,1):i.set(e,[]))},emit:function(e,t){var r=i.get(e);r&&r.slice().map(function(e){e(t)}),(r=i.get("*"))&&r.slice().map(function(i){i(e,t)})}},this.remoteFetcher=tn(this.store,this.options.customFetcher),this.staticFetcher=tn(this.store,(e,t)=>t)}defaultFetcher=e=>fetch(e).then(e=>e.json());batch(e){this.isBatching=!0;try{e(this),this.store.dispatch(e7({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[],this.isBatching=!1}async asyncBatch(e){this.isBatching=!0;try{await e(this),this.store.dispatch(e7({actions:this.batchQueue}))}catch(e){throw this.batchQueue=[],this.isBatching=!1,e}this.batchQueue=[],this.isBatching=!1}modifyEntityField(e,t,i){this.dispatch(eW.modifyEntityField({id:e.id,type:e.type,key:t,value:i}))}dispatch(e){this.isBatching?this.batchQueue.push(e):this.store.dispatch(e)}middleware=e=>t=>i=>{if(i.type===e8){for(let t of i.payload.actions)this.emitter.emit(t.type,{realAction:t,state:e.getState()});let r=t(i);for(let e of i.payload.actions)this.emitter.emit(`after:${i.type}`,{action:i,state:r});return r}this.emitter.emit(i.type,{action:i,state:e.getState()});let r=t(i);return this.emitter.emit(`after:${i.type}`,{action:i,state:r}),r};serialize(e,t){return function(e,t,i){if(!t.type||!t.id)throw Error("Unknown entity");if(!i[t.type])throw Error(`Serializer not found for ${t.type}`);return function r(n){let a=i[n.type];if(!a)return eo;let o=function(e,t){let i=e.requests[t],r=e.mapping[t];if(r&&(!i||!i.resourceUri||e.entities[r][i.resourceUri]))return e.entities[r][i?i.resourceUri:t]}(e,n.id)||(n.id&&n.type?n:null);if(!o)return eo;let s=a(o,e,{isTopLevel:t.id===n.id}),l=s.next();for(;!l.done;){let e=l.value,t=eo;if(e){if(Array.isArray(e)){let i=[];for(let t of e)i.push(r(t));t=i}else t=r(e)}l=s.next(t)}return l.value===eo?eo:function(e){let t={};for(let[i,r]of e){if(i===es&&r!==eo)return r;r!==eo&&null!=r&&(t[i]=r)}return t}(l.value)}(t)}(this.getState().iiif,e,t)}toPresentation2(e){return this.serialize(e,ed)}toPresentation3(e){return this.serialize(e,ew)}hydrate(e,t){return this.get(e,t,{skipSelfReturn:!1})}get(e,t,i={}){"string"!=typeof t&&(i=t||{},t=void 0);let{skipSelfReturn:r=!0}=i||{};if(Array.isArray(e))return e.map(e=>this.get(e,i));let n=this.getState();if("string"==typeof e){let i=t||n.iiif.mapping[e];if(!i)return r?null:{id:e,type:"unknown"};e={id:e,type:i}}let a=t||e.type,o=e.id,s=n.iiif.entities[a];if(!s){let t=n.iiif.requests[o];return t&&t.resourceUri!==o?this.get(t.resourceUri,i):r?null:e}return s[e.id]||(r?null:e)}select(e){return e(this.getState())}getStore(){return this.store}getState(){return this.store.getState()}loadManifest(e,t){let i="string"==typeof e?e:e.id;return this.load(i,t)}loadCollection(e,t){let i="string"==typeof e?e:e.id;return this.load(i,t)}load(e,t){let i="string"==typeof e?e:e.id;return t?this.staticFetcher(i,t):this.remoteFetcher(i)}areInputsEqual(e,t){return ti(e,t)}subscribe(e,t,i){void 0===i&&(void 0===t||!1===t||!0===t)&&(i=t,t=e,e=e=>e);let r=i?null:e(this.store.getState());return i||t(r,this),this.store.subscribe(()=>{let i=this.store.getState(),n=e(i);r===n||ti(r,n)||t(n,this),r=n})}async ensureLoaded(e){let t="string"==typeof e?e:e.id;this.requestStatus(t)||await this.load(t)}requestStatus(e){return this.select(t=>t.iiif.requests[e])}getResourceMeta(e,t){let i=this.getState().iiif.meta[e];return i?t?i[t]:i:void 0}setMetaValue([e,t,i],r){this.dispatch("function"==typeof r?eK.setMetaValueDynamic({id:e,meta:t,key:i,updateValue:r}):eK.setMetaValue({id:e,meta:t,key:i,value:r}))}}}}]);