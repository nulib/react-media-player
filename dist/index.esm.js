var Gt=Object.defineProperty,jt=Object.defineProperties;var Zt=Object.getOwnPropertyDescriptors;var we=Object.getOwnPropertySymbols;var Kt=Object.prototype.hasOwnProperty,Ut=Object.prototype.propertyIsEnumerable;var Se=(e,t,r)=>t in e?Gt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,b=(e,t)=>{for(var r in t||(t={}))Kt.call(t,r)&&Se(e,r,t[r]);if(we)for(var r of we(t))Ut.call(t,r)&&Se(e,r,t[r]);return e},z=(e,t)=>jt(e,Zt(t));import P,{useEffect as Ht,useState as Qr}from"react";import M from"react";import{Vault as _t}from"@iiif/vault";var Te={showTitle:!0,showIIIFBadge:!0,ignoreCaptionLabels:[]},te={activeCanvas:"",configOptions:Te,isLoaded:!1,vault:new _t},Fe=M.createContext(te),ke=M.createContext(te);function qt(e,t){switch(t.type){case"updateActiveCanvas":return t.canvasId||(t.canvasId=""),z(b({},e),{activeCanvas:t.canvasId});case"updateConfigOptions":return z(b({},e),{configOptions:b(b({},Te),t.configOptions)});case"updateIsLoaded":return z(b({},e),{isLoaded:t.isLoaded});default:throw new Error(`Unhandled action type: ${t.type}`)}}var Ee=({initialState:e=te,children:t})=>{let[r,n]=M.useReducer(qt,e);return M.createElement(Fe.Provider,{value:r},M.createElement(ke.Provider,{value:n},t))};function k(){let e=M.useContext(Fe);if(e===void 0)throw new Error("useViewerState must be used within a ViewerProvider");return e}function j(){let e=M.useContext(ke);if(e===void 0)throw new Error("useViewerDispatch must be used within a ViewerProvider");return e}import H,{useEffect as Ce,useState as G}from"react";function Ae(e){return e.service?`${e.service[0].id}/full/,${e.height||500}/0/default.jpg`:e.id}var re=e=>{if(!!e)try{let t=e.thumbnail;return t&&t.length>0?Ae(t[0]):Ae(e.items[0].items[0].body)}catch(t){console.error("Error retrieving accompanying canvas image",t);return}};var L=(e,t,r,n)=>{var i,l;let o={canvas:void 0,accompanyingCanvas:void 0,annotationPage:void 0,annotations:[]},a=d=>{if(d){if(!d.body||!d.motivation){console.error("Invalid annotation after Hyperion parsing: missing either 'body' or 'motivation'",d);return}if(!d.body)return;let p=d.body;Array.isArray(p)&&(p=p[0]);let u=e.get(p.id);if(!u)return;switch(r){case"painting":return d.target===t.id&&d.motivation&&d.motivation[0]==="painting"&&n.includes(u.type)&&(d.body=u),d;case"supplementing":return;default:throw new Error("Invalid annotation motivation.")}}};return o.canvas=e.get(t),o.canvas&&(o.annotationPage=e.get(o.canvas.items[0]),o.accompanyingCanvas=(i=o.canvas)!=null&&i.accompanyingCanvas?e.get((l=o.canvas)==null?void 0:l.accompanyingCanvas):void 0),o.annotationPage&&(o.annotations=e.get(o.annotationPage.items).filter(a)),o};var oe=(e,t)=>{let r=L(e,{id:t,type:"Canvas"},"painting",["Image","Sound","Video"]);if(r.annotations.length!==0&&r.annotations[0]&&r.annotations[0].body)return r.annotations[0].body};var ne=(e,t,r)=>{let n=e.get({id:t,type:"Canvas"});if(!(n!=null&&n.annotations)||!n.annotations[0])return[];let o=e.get(n.annotations[0]),a=e.get(o.items);return Array.isArray(a)?a.filter(i=>{var l;if(!!i.body&&(l=i.motivation)!=null&&l.includes("supplementing")){let d=i.body;Array.isArray(d)&&(d=d[0]);let p=e.get(d.id);if(p.format===r)return i.body=p,i}}).map(i=>i.body):[]};var C=(e,t="en")=>{if(!e)return"";if(!e[t]){let r=Object.getOwnPropertyNames(e);if(r.length>0)return e[r[0]]}return e[t]};var ie=(e,t,r,n)=>{let o=[];if(t.canvas&&t.canvas.thumbnail.length>0){let l=e.get(t.canvas.thumbnail[0]);o.push(l)}if(t.annotations[0]){if(t.annotations[0].thumbnail&&t.annotations[0].thumbnail.length>0){let d=e.get(t.annotations[0].thumbnail[0]);o.push(d)}if(!t.annotations[0].body)return;let l=t.annotations[0].body;l.type==="Image"&&o.push(l)}return o.length===0?void 0:{id:o[0].id,format:o[0].format,type:o[0].type,width:r,height:n}};import{createStitches as Qt}from"@stitches/react";var Xt={colors:{primary:"#1a1d1e",primaryMuted:"#26292b",primaryAlt:"#151718",accent:"#006adc",accentMuted:"#5eb0ef",accentAlt:"#00254d",secondary:"#FFFFFF",secondaryMuted:"#e6e8eb",secondaryAlt:"#c1c8cd"},fonts:{sans:"'Inter', Arial, sans-serif",display:"'Calistoga', 'Inter', Arial, sans-serif"},transitions:{all:"all 500ms cubic-bezier(0.16, 1, 0.3, 1)"}},ae={xxs:"(max-width: 349px)",xs:"(max-width: 575px)",sm:"(max-width: 767px)",md:"(max-width: 991px)",xl:"(max-width: 1199px)",lg:"(min-width: 1200px)"},{styled:s,css:vo,keyframes:Ve,createTheme:Co}=Qt({theme:Xt,media:ae});import*as Z from"@radix-ui/react-collapsible";var se=s("div",{position:"relative",zIndex:"0"}),le=s("div",{display:"flex",flexDirection:"row",overflow:"hidden","@sm":{flexDirection:"column"}}),de=s("div",{display:"flex",flexDirection:"column",flexGrow:"1",flexShrink:"1",width:"61.8%","@sm":{width:"100%"}}),Pe=s(Z.Trigger,{display:"none",background:"transparent",border:"none",margin:"0",padding:"0",transition:"$all",opacity:"1",marginTop:"0","&[data-navigator='false']":{opacity:"0",marginTop:"-59px"},"@sm":{display:"flex","> span":{display:"flex",flexGrow:"1",margin:"1rem 1rem 0"}}}),pe=s(Z.Content,{width:"100%",display:"flex"}),$e=s("aside",{display:"flex",flexGrow:"1",flexShrink:"0",width:"38.2%","@sm":{width:"100%"}}),We=s("section",{display:"flex",flexDirection:"column",padding:"1.618rem",fontFamily:"$sans",backgroundColor:"$secondary",fontSmooth:"auto",webkitFontSmoothing:"antialiased","> div":{display:"flex",flexDirection:"column",flexGrow:"1",justifyContent:"flex-start","@sm":{[`& ${le}`]:{flexGrow:"1"},[`& ${de}`]:{flexGrow:"0"}}},"@sm":{padding:"0"},"&[data-navigator-open='true']":{"@sm":{position:"fixed",height:"100%",width:"100%",top:"0",left:"0",zIndex:"2500000000",[`& ${se}`]:{display:"none"},[`& ${pe}`]:{height:"100%"}}}});import{useEffect as Yt,useState as Jt}from"react";var Me=e=>{let t=()=>window.matchMedia?window.matchMedia(e).matches:!1,[r,n]=Jt(t);return Yt(()=>{let o=()=>n(t);return window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)}),r};import{useEffect as er,useLayoutEffect as tr,useState as rr}from"react";var Le=(e=!1)=>{let[t,r]=rr(e);return tr(()=>{if(!t)return;let n=document.documentElement.style.overflow;return document.documentElement.style.overflow="hidden",()=>{document.documentElement.style.overflow=n}},[t]),er(()=>{t!==e&&r(e)},[e]),[t,r]};import*as Dt from"@radix-ui/react-collapsible";import A from"react";import{Popover as ze}from"@nulib/design-system";var Ne=s(ze.Trigger,{width:"30px",padding:"5px"}),Be=s(ze.Content,{display:"flex",flexDirection:"column",fontSize:"0.8333rem",button:{display:"flex",textDecoration:"none",fontFamily:"$sans",marginBottom:"0.5em",color:"$accentAlt",cursor:"pointer",background:"$secondary",border:"none",["&:last-child"]:{marginBottom:"0"}}}),Re=s("header",{display:"flex",backgroundColor:"transparent !important",justifyContent:"space-between",padding:"0 0 0.5rem",span:{fontSize:"1.25rem",fontWeight:"700",fontFamily:"$display","@sm":{padding:"1rem",fontSize:"1rem"}}});import{Popover as pr}from"@nulib/design-system";import S from"react";var or=()=>{let e="#ed1d33",t="#2873ab";return S.createElement("svg",{viewBox:"0 0 493.35999 441.33334",id:"iiif-logo",version:"1.1"},S.createElement("title",null,"IIIF Manifest Options"),S.createElement("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,441.33333)"},S.createElement("g",{transform:"scale(0.1)"},S.createElement("path",{style:{fill:t},d:"M 65.2422,2178.75 775.242,1915 773.992,15 65.2422,276.25 v 1902.5"}),S.createElement("path",{style:{fill:t},d:"m 804.145,2640.09 c 81.441,-240.91 -26.473,-436.2 -241.04,-436.2 -214.558,0 -454.511,195.29 -535.9527,436.2 -81.4335,240.89 26.4805,436.18 241.0387,436.18 214.567,0 454.512,-195.29 535.954,-436.18"}),S.createElement("path",{style:{fill:e},d:"M 1678.58,2178.75 968.578,1915 969.828,15 1678.58,276.25 v 1902.5"}),S.createElement("path",{style:{fill:e},d:"m 935.082,2640.09 c -81.437,-240.91 26.477,-436.2 241.038,-436.2 214.56,0 454.51,195.29 535.96,436.2 81.43,240.89 -26.48,436.18 -241.04,436.18 -214.57,0 -454.52,-195.29 -535.958,-436.18"}),S.createElement("path",{style:{fill:t},d:"m 1860.24,2178.75 710,-263.75 -1.25,-1900 -708.75,261.25 v 1902.5"}),S.createElement("path",{style:{fill:t},d:"m 2603.74,2640.09 c 81.45,-240.91 -26.47,-436.2 -241.03,-436.2 -214.58,0 -454.52,195.29 -535.96,436.2 -81.44,240.89 26.48,436.18 241.03,436.18 214.57,0 454.51,-195.29 535.96,-436.18"}),S.createElement("path",{style:{fill:e},d:"m 3700.24,3310 v -652.5 c 0,0 -230,90 -257.5,-142.5 -2.5,-247.5 0,-336.25 0,-336.25 l 257.5,83.75 V 1690 l -258.61,-92.5 V 262.5 L 2735.24,0 v 2360 c 0,0 -15,850 965,950"}))))},De=or;import ce from"react";import{useCallback as nr,useEffect as ir,useState as ar}from"react";var Oe=(e,t=2500)=>{let[r,n]=ar(),o=nr(()=>{navigator.clipboard.writeText(e).then(()=>n("copied"),()=>n("failed"))},[e]);return ir(()=>{if(!r)return;let a=setTimeout(()=>n(void 0),t);return()=>clearTimeout(a)},[r]),[r,o]};var sr=s("span",{display:"flex",alignContent:"center",alignItems:"center",padding:"0.125rem 0.25rem 0",marginTop:"-0.125rem",marginLeft:"0.5rem",backgroundColor:"$accent",color:"$secondary",borderRadius:"3px",fontSize:"0.6111rem",textTransform:"uppercase",lineHeight:"1em"}),lr=({status:e})=>e?ce.createElement(sr,{"data-copy-status":e},e):null,dr=({textPrompt:e,textToCopy:t})=>{let[r,n]=Oe(t);return ce.createElement("button",{onClick:n},e," ",ce.createElement(lr,{status:r}))},He=dr;var cr=({manifestId:e,manifestLabel:t})=>{let r=k(),{configOptions:n}=r;return A.createElement(Re,null,n.showTitle&&A.createElement("span",null,C(t,"en")),A.createElement("p",null,"Is this real"),n.showIIIFBadge&&A.createElement(pr,null,A.createElement(Ne,null,A.createElement(De,null)),A.createElement(Be,null,A.createElement("button",{onClick:o=>{o.preventDefault(),window.open(e,"_blank")}},"View Manifest"),A.createElement(He,{textPrompt:"Copy Manifest URL",textToCopy:e}))))},Ge=cr;import w from"react";import N,{useEffect as fe,useState as ge}from"react";import*as je from"@radix-ui/react-radio-group";var Ze=s(je.Root,{display:"flex",flexDirection:"row",flexGrow:"1",padding:"1.618rem 0.618rem 1.618rem 0 ",overflowX:"scroll",position:"relative",zIndex:"0","@sm":{padding:"1rem"}});import x from"react";var mr=e=>{var t=e.toString().split(":"),r=Math.ceil(parseInt(t[0])),n=Math.ceil(parseInt(t[1])),o=ur(Math.ceil(parseInt(t[2])),2);let i=`${r!==0&&n<10?(n+"").padStart(2,"0"):n}:${o}`;return r!==0&&(i=`${r}:${i}`),i},K=e=>{let t=new Date(e*1e3).toISOString().substr(11,8);return mr(t)};var ur=(e,t)=>String(e).padStart(t,"0");import{Icon as B,Tag as fr}from"@nulib/design-system";import*as Ue from"@radix-ui/react-radio-group";import{Tag as Ke}from"@nulib/design-system";var U=s("span",{display:"flex"}),_e=s("span",{display:"flex",width:"1.2111rem",height:"0.7222rem"}),qe=s("span",{display:"inline-flex",marginLeft:"5px",marginBottom:"-1px"}),Qe=s(Ue.Item,{display:"flex",flexShrink:"0",margin:"0 1.618rem 0 0",padding:"0",cursor:"pointer",background:"none",border:"none",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",textAlign:"left","&:last-child":{marginRight:"1rem"},"@sm":{margin:"0 1rem 0 0","&:last-child":{marginRight:"0"}},figure:{margin:"0",width:"161.8px","@sm":{width:"123px"},"> div":{position:"relative",display:"flex",backgroundColor:"$secondaryAlt",width:"inherit",height:"100px",overflow:"hidden",borderRadius:"3px",transition:"$all","@sm":{height:"76px"},img:{width:"100%",height:"100%",objectFit:"cover",filter:"blur(0)",transform:"scale3d(1, 1, 1)",transition:"$all",color:"transparent"},[`& ${U}`]:{position:"absolute",right:"0.5rem",bottom:"0.5rem","@sm":{right:"0",bottom:"0"},[`& ${Ke}`]:{margin:"0",paddingLeft:"0",fontSize:"0.7222rem",backgroundColor:"#000d",color:"$secondary",fill:"$secondary","@sm":{borderBottomLeftRadius:"0",borderTopRightRadius:"0"}}}},figcaption:{marginTop:"0.5rem",color:"$primaryMuted",fontWeight:"400",fontSize:"0.8333rem",display:"-webkit-box",overflow:"hidden",MozBoxOrient:"vertical",WebkitLineClamp:"5","@sm":{fontSize:"0.8333rem"}}},"&[aria-checked='true']":{figure:{"> div":{backgroundColor:"$primaryAlt","&::before":{position:"absolute",zIndex:"1",color:"$secondaryMuted",content:"Active Item",textTransform:"uppercase",fontWeight:"700",fontSize:"0.6111rem",letterSpacing:"0.03rem",display:"flex",width:"100%",height:"100%",flexDirection:"column",justifyContent:"center",textAlign:"center",textShadow:"5px 5px 5px #0003"},img:{opacity:"0.3",transform:"scale3d(1.1, 1.1, 1.1)",filter:"blur(2px)"},[`& ${U}`]:{[`& ${Ke}`]:{backgroundColor:"$accent"}}}},figcaption:{fontWeight:"700",color:"$primary"}}});var gr=({type:e})=>{switch(e){case"Sound":return x.createElement(B.Audio,null);case"Image":return x.createElement(B.Image,null);case"Video":return x.createElement(B.Video,null);default:return x.createElement(B.Image,null)}},hr=({canvas:e,canvasIndex:t,isActive:r,thumbnail:n,type:o,handleChange:a})=>{let i=C(e.label,"en");return x.createElement(Qe,{"aria-checked":r,"data-testid":"media-thumbnail","data-canvas":t,onClick:()=>a(e.id),value:e.id},x.createElement("figure",null,x.createElement("div",null,(n==null?void 0:n.id)&&x.createElement("img",{src:n.id,alt:i}),x.createElement(U,null,x.createElement(fr,{isIcon:!0,"data-testid":"thumbnail-tag"},x.createElement(_e,null),x.createElement(B,{"aria-label":o},x.createElement(gr,{type:o})),["Video","Sound"].includes(o)&&x.createElement(qe,null,K(e.duration))))),x.createElement("figcaption",{"data-testid":"fig-caption"},i)))},Xe=hr;var Ye=e=>e.body?e.body.type:"Image";import g,{useEffect as xr,useState as ue}from"react";var me=s("div",{position:"absolute",right:"1rem",top:"1rem",display:"flex",justifyContent:"flex-end",zIndex:"1"}),Je=s("input",{flexGrow:"1",border:"none",backgroundColor:"$secondaryMuted",color:"$primary",marginRight:"1rem",height:"2rem",padding:"0 1rem",borderRadius:"2rem",fontFamily:"$sans",fontSize:"1rem",lineHeight:"1rem",boxShadow:"inset 1px 1px 2px #0003","&::placeholder":{color:"$primaryMuted"}}),R=s("button",{display:"flex",background:"none",border:"none",width:"2rem !important",height:"2rem !important",padding:"0",margin:"0",fontWeight:"700",borderRadius:"2rem",backgroundColor:"$accent",color:"$secondary",cursor:"pointer",boxSizing:"content-box !important",transition:"$all",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",opacity:"1",filter:"drop-shadow(5px 5px 5px #000D)",boxSizing:"inherit",transition:"$all"},"&:disabled":{backgroundColor:"transparent",boxShadow:"none",svg:{opacity:"0.25"}}}),et=s("div",{display:"flex",marginRight:"0.618rem",backgroundColor:"$accentAlt",borderRadius:"2rem",boxShadow:"5px 5px 5px #0003",color:"$secondary",alignItems:"center","> span":{display:"flex",margin:"0 0.5rem",fontSize:"0.7222rem"},[`& ${R}`]:{}}),tt=s("div",{display:"flex",position:"relative",zIndex:"1",width:"100%",padding:"0",transition:"$all",variants:{isToggle:{true:{paddingTop:"2.618rem",[`& ${me}`]:{width:"calc(100% - 2rem)","@sm":{width:"calc(100% - 2rem)"}}}}}});import{useEffect as yr}from"react";var br=(e,t)=>{yr(()=>{function r(n){n.key===e&&t()}return window.addEventListener("keyup",r),()=>window.removeEventListener("keyup",r)},[])},rt=br;var vr=()=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g.createElement("title",null,"Arrow Back"),g.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M244 400L100 256l144-144M120 256h292"})),Cr=()=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g.createElement("title",null,"Arrow Forward"),g.createElement("path",{fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M268 112l144 144-144 144M392 256H100"})),Ir=()=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g.createElement("title",null,"Close"),g.createElement("path",{d:"M289.94 256l95-95A24 24 0 00351 127l-95 95-95-95a24 24 0 00-34 34l95 95-95 95a24 24 0 1034 34l95-95 95 95a24 24 0 0034-34z"})),wr=()=>g.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512"},g.createElement("title",null,"Search"),g.createElement("path",{d:"M456.69 421.39L362.6 327.3a173.81 173.81 0 0034.84-104.58C397.44 126.38 319.06 48 222.72 48S48 126.38 48 222.72s78.38 174.72 174.72 174.72A173.81 173.81 0 00327.3 362.6l94.09 94.09a25 25 0 0035.3-35.3zM97.92 222.72a124.8 124.8 0 11124.8 124.8 124.95 124.95 0 01-124.8-124.8z"})),Sr=({handleCanvasToggle:e,handleFilter:t,activeIndex:r,canvasLength:n})=>{let[o,a]=ue(!1),[i,l]=ue(!1),[d,p]=ue(!1);xr(()=>{p(r===0),r===n-1?l(!0):l(!1)},[r]),rt("Escape",()=>{a(!1),t("")});let u=()=>{a(h=>!h),t("")};return g.createElement(tt,{isToggle:o},g.createElement(me,null,o&&g.createElement(Je,{autoFocus:!0,onChange:h=>t(h.target.value),placeholder:"Search"}),!o&&g.createElement(et,null,g.createElement(R,{onClick:()=>e(-1),disabled:d,type:"button"},g.createElement(vr,null)),g.createElement("span",null,r+1," of ",n),g.createElement(R,{onClick:()=>e(1),disabled:i,type:"button"},g.createElement(Cr,null))),g.createElement(R,{onClick:u,type:"button"},o?g.createElement(Ir,null):g.createElement(wr,null))))},ot=Sr;var Tr=({items:e})=>{let t=j(),r=k(),{activeCanvas:n,vault:o}=r,[a,i]=ge(""),[l,d]=ge([]),[p,u]=ge(0),f=N.useRef(null),h="painting",v=["Image","Sound","Video"],c=m=>{n!==m&&t({type:"updateActiveCanvas",canvasId:m})};return fe(()=>{for(let m of e){let y=L(o,m,h,v);y.annotations.length>0&&d(F=>[...F,y])}},[]),fe(()=>{l.forEach((m,y)=>{m!=null&&m.canvas&&m.canvas.id===n&&u(y)})},[n]),fe(()=>{let m=document.querySelector(`[data-canvas="${p}"]`);if(m instanceof HTMLElement&&f.current){let y=m.offsetLeft-f.current.offsetWidth/2+m.offsetWidth/2;f.current.scrollTo({left:y,behavior:"smooth"})}},[p]),N.createElement(N.Fragment,null,N.createElement(ot,{handleFilter:m=>i(m),handleCanvasToggle:m=>{let y=l[p+m];y!=null&&y.canvas&&c(y.canvas.id)},activeIndex:p,canvasLength:l.length}),N.createElement(Ze,{"aria-label":"select item","data-testid":"media",ref:f},l.filter(m=>{var y;if((y=m.canvas)!=null&&y.label){let F=C(m.canvas.label);if(Array.isArray(F))return F[0].toLowerCase().includes(a.toLowerCase())}}).map((m,y)=>{var F,Ie;return N.createElement(Xe,{canvas:m.canvas,canvasIndex:y,handleChange:c,isActive:n===((F=m==null?void 0:m.canvas)==null?void 0:F.id),key:(Ie=m==null?void 0:m.canvas)==null?void 0:Ie.id,thumbnail:ie(o,m,200,200),type:Ye(m.annotations[0])})})))},nt=Tr;import W,{useEffect as $r,useState as Wr}from"react";import*as $ from"@radix-ui/react-tabs";var it=s($.Root,{display:"flex",flexDirection:"column",width:"100%",height:"100%",flexGrow:"1",flexShrink:"0",position:"relative",zIndex:"1",boxShadow:"-5px -5px 5px #00000011","@sm":{marginTop:"0.5rem",boxShadow:"none"},"&:after":{position:"absolute",bottom:0,content:"",width:"100%",height:"1rem",backgroundImage:"linear-gradient(0deg, #FFFFFF 0%, #FFFFFF00 100%)",zIndex:1,"@sm":{backgroundImage:"none"}}}),at=s($.List,{display:"flex",flexGrow:"0",margin:"0 1.618rem",borderBottom:"4px solid $secondaryAlt",backgroundColor:"$secondary","@sm":{margin:"0 1rem"}}),st=s($.Trigger,{display:"flex",position:"relative",padding:"0.5rem 1rem",background:"none",backgroundColor:"transparent",color:"$primaryMuted",border:"none",fontFamily:"inherit",fontSize:"1rem",marginRight:"1rem",lineHeight:"1rem",whiteSpace:"nowrap",cursor:"pointer",fontWeight:700,transition:"$all","&::after":{width:"0",height:"4px",content:"",backgroundColor:"$primaryMuted",position:"absolute",bottom:"-4px",left:"0",transition:"$all"},"&:hover":{color:"$primary"},"&[data-state='active']":{color:"$accent","&::after":{width:"100%",backgroundColor:"$accent"}}}),lt=s($.Content,{display:"flex",flexGrow:"1",flexShrink:"0",position:"absolute",top:"0",left:"0","&[data-state='active']":{width:"100%",height:"calc(100% - 2rem)",padding:"1rem 0"}}),dt=s("div",{position:"relative",height:"100%",width:"100%",overflowY:"scroll"});import ye,{useEffect as Ar}from"react";import*as _ from"@radix-ui/react-radio-group";var pt=Ve({from:{transform:"rotate(360deg)"},to:{transform:"rotate(0deg)"}}),ct=s(_.Root,{display:"flex",flexDirection:"column",width:"100%"}),q=s(_.Item,{position:"relative",cursor:"pointer",display:"flex",width:"100%",justifyContent:"space-between",textAlign:"left",margin:"0",padding:"0.5rem 1.618rem",fontFamily:"inherit",lineHeight:"1.25em",fontSize:"1rem",color:"$primaryMuted",border:"none",background:"none","@sm":{padding:"0.5rem 1rem",fontSize:"0.8333rem"},"&::before":{content:"",width:"12px",height:"12px",borderRadius:"12px",position:"absolute",backgroundColor:"$primaryMuted",opacity:"0",left:"8px",marginTop:"3px",boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",opacity:"0",clipPath:"polygon(100% 50%, 0 100%, 0 0)",left:"13px",marginTop:"6px",boxSizing:"content-box","@sm":{content:"unset"}},strong:{marginLeft:"1rem"},"&:hover":{color:"$accent","&::before":{backgroundColor:"$accent",opacity:"1"},"&::after":{content:"",width:"4px",height:"6px",position:"absolute",backgroundColor:"$secondary",clipPath:"polygon(100% 50%, 0 100%, 0 0)",opacity:"1"}},"&[aria-checked='true']":{color:"$primary",backgroundColor:"$secondaryMuted",fontFamily:"$sansBold","&::before":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accentMuted",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1s linear infinite",animationName:pt,boxSizing:"content-box","@sm":{content:"unset"}},"&::after":{content:"",width:"6px",height:"6px",position:"absolute",backgroundColor:"transparent",border:"3px solid $accent",clipPath:"polygon(100% 0, 100% 100%, 0 0)",borderRadius:"12px",left:"8px",marginTop:"4px",opacity:"1",animation:"1.5s linear infinite",animationName:pt,boxSizing:"content-box","@sm":{content:"unset"}}}});import{v4 as Fr}from"uuid";var kr=()=>{function e(o){return o.map(i=>{let l=i.identifier||Fr();return z(b({},i),{identifier:l})})}function t(o){let a=e(o);function i(d,p){let u=[];return d.forEach(f=>{let v=d.filter(c=>f.start>=c.start&&f.end<=c.end&&f.identifier!==c.identifier).sort((c,T)=>{let E=c.end-c.start,m=T.end-T.start;return E===m?0:E<m?-1:1})[0];if(!v&&!p||(v==null?void 0:v.identifier)===p){let c=i(d,f.identifier);c.length&&(f.children=c),u.push(f)}}),u}return i(a,null)}function r(o,a=[]){return a.some(i=>o.start>=i.start&&o.end<=i.end)}function n(o=[]){return o.sort((a,i)=>a.start-i.start)}return{addIdentifiersToParsedCues:e,createNestedCues:t,isChild:r,orderCuesByTime:n}},mt=kr;import X from"react";import he from"react";import Q from"react";var ut={currentTime:0,startTime:0,updateStartTime:()=>{},updateCurrentTime:()=>{}},D=Q.createContext(ut),ft=({children:e})=>{let[t,r]=Q.useState(ut.currentTime),[n,o]=Q.useState(0),a=l=>o(l),i=l=>r(l);return Q.createElement(D.Provider,{value:{currentTime:t,startTime:n,updateStartTime:a,updateCurrentTime:i}},e)};var Er=({label:e,start:t,end:r})=>{let{currentTime:n,updateStartTime:o}=he.useContext(D),a=t<=n&&n<r;return he.createElement(q,{"aria-checked":a,"data-testid":"navigator-cue",onClick:()=>{o(t)},value:e},e,he.createElement("strong",null,K(t)))},gt=Er;var ht=s("ul",{listStyle:"none",paddingLeft:"1rem",position:"relative","&&:first-child":{paddingLeft:"0"},"& li ul":{[`& ${q}`]:{backgroundColor:"unset","&::before":{content:"none"},"&::after":{content:"none"}}},"&:first-child":{margin:"0 0 1.618rem"}});var yt=({items:e})=>X.createElement(ht,null,e.map(({text:t,start:r,end:n,children:o,identifier:a})=>X.createElement("li",{key:a},X.createElement(gt,{label:t,start:r,end:n}),o&&X.createElement(yt,{items:o})))),bt=yt;import{parse as Vr}from"node-webvtt";var Pr=({resource:e})=>{let[t,r]=ye.useState([]),{id:n,label:o}=e,{createNestedCues:a,orderCuesByTime:i}=mt();return Ar(()=>{fetch(n,{headers:{"Content-Type":"text/plain",Accept:"application/json"}}).then(l=>l.text()).then(l=>{let d=Vr(l).cues,p=i(d),u=a(p);r(u)}).catch(l=>console.error(n,l.toString()))},[n]),ye.createElement(ct,{"aria-label":`navigate ${C(o,"en")}`},ye.createElement(bt,{items:t}))},xt=Pr;var Mr=({activeCanvas:e,defaultResource:t,resources:r})=>{let[n,o]=Wr(t);$r(()=>{o(t)},[e,r]);let a=i=>{o(i)};return r?W.createElement(it,{"data-testid":"navigator",defaultValue:t,onValueChange:a,orientation:"horizontal",value:n},W.createElement(at,{"aria-label":"select chapter","data-testid":"navigator-list"},r.map(({id:i,label:l})=>W.createElement(st,{key:i,value:i},C(l,"en")))),W.createElement(dt,null,r.map(i=>W.createElement(lt,{key:i.id,value:i.id},W.createElement(xt,{resource:i}))))):W.createElement(W.Fragment,null)},vt=Mr;import V from"react";import O from"hls.js";var Ct=s("div",{position:"relative",backgroundColor:"$primaryAlt",display:"flex",flexGrow:"0",flexShrink:"1",maxHeight:"450px",zIndex:"1",video:{backgroundColor:"transparent",display:"flex",position:"relative",objectFit:"contain",width:"100%",height:"100%",zIndex:"1"}});import Y from"react";var It=s("canvas",{position:"absolute",width:"100%",height:"100%"});var Lr=Y.forwardRef((e,t)=>{let r=Y.useRef(null);Y.useEffect(()=>{!t||(t.current.onplay=n)},[t]);function n(){let a=t.current,i=new AudioContext,l=i.createMediaElementSource(a),d=i.createAnalyser(),p=r.current;if(!p)return;p.width=a.offsetWidth,p.height=a.offsetHeight;let u=p.getContext("2d");l.connect(d),d.connect(i.destination),d.fftSize=256;let f=d.frequencyBinCount,h=new Uint8Array(f);setInterval(function(){o(d,u,f,h,p.width,p.height)},20)}function o(a,i,l,d,p,u){let f=p/l*2.6,h,v=0;a.getByteFrequencyData(d),i.fillStyle="#000000",i.fillRect(0,0,p,u);for(let c=0;c<l;c++)h=d[c]*2,i.fillStyle=`rgba(${78}, 42, 132, 1)`,i.fillRect(v,u-h,f,h),v+=f+6}return Y.createElement(It,{ref:r})}),wt=Lr;import zr from"react";var Nr=({resource:e,ignoreCaptionLabels:t})=>{let r=C(e.label,"en");return r.some(o=>t.includes(o))?null:zr.createElement("track",{key:e.id,src:e.id,label:r,srcLang:"en","data-testid":"player-track"})},St=Nr;var Br=({painting:e,resources:t})=>{var v;let r=V.useRef(null),n=(v=e==null?void 0:e.format)==null?void 0:v.includes("audio/"),{startTime:o,updateCurrentTime:a}=V.useContext(D),i=k(),{activeCanvas:l,configOptions:d,vault:p}=i,u=L(p,{id:l,type:"Canvas"},"painting",["Image"]),f=re(u.accompanyingCanvas);V.useEffect(()=>{if(!e.id||!r.current||e.id.split(".").pop()!=="m3u8")return;let c=new O;return c.attachMedia(r.current),c.on(O.Events.MEDIA_ATTACHED,function(){c.loadSource(e.id)}),c.on(O.Events.ERROR,function(T,E){if(E.fatal)switch(E.type){case O.ErrorTypes.NETWORK_ERROR:console.error(`fatal ${T} network error encountered, try to recover`),c.startLoad();break;case O.ErrorTypes.MEDIA_ERROR:console.error(`fatal ${T} media error encountered, try to recover`),c.recoverMediaError();break;default:c.destroy();break}}),()=>{c&&(c.detachMedia(),c.destroy(),a(0))}},[e.id]),V.useEffect(()=>{let c=r.current;c&&(c.currentTime=o),o!==0&&c.play()},[o]);let h=()=>{let c=r.current;c&&(c.ontimeupdate=T=>{a(T.target.currentTime)})};return V.createElement(Ct,null,V.createElement("video",{id:"clover-iiif-video",key:e.id,ref:r,controls:!0,height:e.height,width:e.width,onPlay:h,crossOrigin:"anonymous",poster:f},V.createElement("source",{src:e.id,type:e.format}),t.length>0&&t.map(c=>V.createElement(St,{resource:c,ignoreCaptionLabels:d.ignoreCaptionLabels,key:c.id})),"Sorry, your browser doesn't support embedded videos."),n&&V.createElement(wt,{ref:r}))},Tt=Br;import ee,{useEffect as xe,useState as Wt}from"react";import Gr from"openseadragon";var Ft=s("div",{position:"absolute !important",zIndex:"1",top:"1rem",left:"1rem",width:"161.8px",height:"100px",backgroundColor:"#000D",boxShadow:"5px 5px 5px #0002",borderRadius:"3px","#openseadragon-navigator-displayregion":{border:" 3px solid $accent !important",boxShadow:"0 0 3px #0006"},"@sm":{width:"123px",height:"76px"}}),kt=s("div",{position:"relative",width:"100%",height:"100%",zIndex:"0"}),Et=s("div",{width:"100%",height:"450px",background:"black",backgroundSize:"contain",color:"white",position:"relative",zIndex:"1",overflow:"hidden"});import I from"react";import be from"react";import{styled as Rr}from"@stitches/react";var At=Rr("button",{display:"flex",height:"2rem",width:"2rem",borderRadius:"2rem",padding:"0",margin:"0",fontFamily:"inherit",background:"none",border:"none",color:"white",cursor:"pointer",marginLeft:"0.618rem",backgroundColor:"#000D",filter:"drop-shadow(5px 5px 5px #0006)",transition:"$all",boxSizing:"content-box !important",svg:{height:"60%",width:"60%",padding:"20%",fill:"$secondary",stroke:"$secondary",filter:"drop-shadow(5px 5px 5px #000D)",transition:"$all",boxSizing:"inherit"},"&:hover, &:focus":{backgroundColor:"$accent"},"&#zoomReset":{"&:hover, &:focus":{svg:{rotate:"45deg"}}}});var Dr=({id:e,label:t,children:r})=>be.createElement(At,{id:e,"data-testid":"openseadragon-button"},be.createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-labelledby":`${e}-svg-title`,"data-testid":"openseadragon-button-svg",focusable:"false",viewBox:"0 0 512 512",role:"img"},be.createElement("title",{id:`${e}-svg-title`},t),r)),J=Dr;import{styled as Or}from"@stitches/react";var Vt=Or("div",{position:"absolute",zIndex:"1",top:"1rem",right:"1rem"});var Hr=()=>I.createElement(Vt,{"data-testid":"openseadragon-controls",id:"openseadragon-controls"},I.createElement(J,{id:"zoomIn",label:"zoom in"},I.createElement(()=>I.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M256 112v288M400 256H112"}),null)),I.createElement(J,{id:"zoomOut",label:"zoom in"},I.createElement(()=>I.createElement("path",{strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 256H112"}),null)),I.createElement(J,{id:"zoomReset",label:"reset zoom"},I.createElement(()=>I.createElement(I.Fragment,null,I.createElement("path",{fill:"none",strokeLinecap:"round",strokeMiterlimit:"10",strokeWidth:"45",d:"M400 148l-21.12-24.57A191.43 191.43 0 00240 64C134 64 48 150 48 256s86 192 192 192a192.09 192.09 0 00181.07-128"}),I.createElement("path",{d:"M464 97.42V208a16 16 0 01-16 16H337.42c-14.26 0-21.4-17.23-11.32-27.31L436.69 86.1C446.77 76 464 83.16 464 97.42z"})),null))),Pt=Hr;var $t=e=>fetch(`${e.replace(/\/$/,"")}/info.json`).then(t=>t.json()).then(t=>t).catch(t=>{console.error(`The IIIF tilesource ${e.replace(/\/$/,"")}/info.json failed to load: ${t}`)});var jr=({service:e})=>{let[t,r]=Wt(),[n,o]=Wt();xe(()=>(a(),()=>{t==null||t.destroy()}),[]),xe(()=>{Array.isArray(e)&&o(e[0])},[e]),xe(()=>{if(n){let i;"@id"in n?i=n["@id"]:i=n.id,i&&$t(i).then(l=>t==null?void 0:t.open(l))}},[t,n]);function a(){let i={homeButton:"zoomReset",showFullPageControl:!1,zoomInButton:"zoomIn",zoomOutButton:"zoomOut"},l={showNavigator:!0,navigatorBorderColor:"transparent",navigatorId:"openseadragon-navigator"};r(Gr(b(b({id:"openseadragon-viewport",loadTilesWithAjax:!0},i),l)))}return ee.createElement(Et,{"data-testid":"image-viewer"},ee.createElement(Pt,null),ee.createElement(Ft,{id:"openseadragon-navigator"}),ee.createElement(kt,{id:"openseadragon-viewport"}))},Mt=jr;import{Button as Zr}from"@nulib/design-system";var Kr=({activeCanvas:e,painting:t,resources:r,items:n,isMedia:o,isNavigator:a,isNavigatorOpen:i})=>w.createElement(le,null,w.createElement(ft,null,w.createElement(de,null,o?w.createElement(Tt,{painting:t,resources:r}):w.createElement(Mt,b({},t)),w.createElement(Pe,{"data-navigator":a},w.createElement(Zr,{as:"span"},i?"View Media Items":"View Navigator")),n.length>1&&w.createElement(se,null,w.createElement(nt,{items:n,activeItem:0}))),a&&w.createElement($e,null,w.createElement(pe,null,w.createElement(vt,{activeCanvas:e,defaultResource:r[0].id,resources:r}))))),Lt=Kr;import ve from"react";var zt=s("div",{display:"flex",flexDirection:"column",alignItems:"center"}),Nt=s("p",{fontFamily:"$display",fontWeight:"bold",fontSize:"x-large"}),Bt=s("span",{fontSize:"medium"});var Ur=({error:e})=>{let{message:t}=e;return ve.createElement(zt,{role:"alert"},ve.createElement(Nt,{"data-testid":"headline"},"Something went wrong"),t&&ve.createElement(Bt,null,`Error message: ${t}`," "))},Rt=Ur;import{ErrorBoundary as _r}from"react-error-boundary";var qr=({manifest:e,theme:t})=>{let r=k(),{activeCanvas:n,vault:o}=r,[a,i]=G(!1),[l,d]=G(!1),[p,u]=G(!0),[f,h]=G(void 0),[v,c]=G([]),[T,E]=Le(!1),m=Me(ae.sm);return Ce(()=>{if(!m){u(!0);return}u(!1)},[m]),Ce(()=>{if(!m){E(!1);return}E(p)},[p]),Ce(()=>{let y=oe(o,n),F=ne(o,n,"text/vtt");y&&(i(["Sound","Video"].indexOf(y.type)>-1),h(b({},y))),c(F),d(F.length!==0)},[n]),H.createElement(_r,{FallbackComponent:Rt},H.createElement(We,{className:t,"data-body-locked":T,"data-navigator":l,"data-navigator-open":p},H.createElement(Dt.Root,{open:p,onOpenChange:u},H.createElement(Ge,{manifestLabel:e.label,manifestId:e.id}),H.createElement(Lt,{activeCanvas:n,painting:f,resources:v,items:e.items,isMedia:a,isNavigator:l,isNavigatorOpen:p}))))},Ot=qr;import{createTheme as Xr}from"@stitches/react";var Yr=({manifestId:e,canvasIdCallback:t=()=>{},customTheme:r,options:n})=>P.createElement(Ee,null,P.createElement(Jr,{manifestId:e,canvasIdCallback:t,customTheme:r,options:n})),Jr=({manifestId:e,canvasIdCallback:t,customTheme:r,options:n})=>{let o=j(),a=k(),{activeCanvas:i,isLoaded:l,vault:d}=a,[p,u]=Qr(),f={};return r&&(f=Xr("custom",r)),Ht(()=>{t&&t(i)},[i]),Ht(()=>{o({type:"updateConfigOptions",configOptions:n}),d.loadManifest(e).then(h=>{u(h),o({type:"updateActiveCanvas",canvasId:h.items[0]&&h.items[0].id})}).catch(h=>{console.error(`Manifest failed to load: ${h}`)}).finally(()=>{o({type:"updateIsLoaded",isLoaded:!0})})},[]),l?!p||!p.items?(console.log(`The IIIF manifest ${e} failed to load.`),P.createElement(P.Fragment,null)):p.items.length===0?(console.log(`The IIIF manifest ${e} does not contain canvases.`),P.createElement(P.Fragment,null)):P.createElement(Ot,{manifest:p,theme:f}):P.createElement(P.Fragment,null,"Loading")},Ia=Yr;export{Ia as default};
//# sourceMappingURL=index.esm.js.map
